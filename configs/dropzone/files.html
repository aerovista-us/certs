<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroVista File Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { @apply bg-zinc-950 text-zinc-200 font-sans; }
        .container { @apply max-w-6xl mx-auto p-6; }
        .header { @apply flex justify-between items-center mb-8; }
        .title { @apply text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600; }
        .file-grid { @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4; }
        .file-card { @apply bg-zinc-900/70 border border-zinc-700/60 rounded-lg p-4 hover:bg-zinc-800/70 transition; }
        .file-icon { @apply w-12 h-12 mx-auto mb-3 text-zinc-400; }
        .file-name { @apply text-zinc-100 font-medium text-sm truncate; }
        .file-size { @apply text-zinc-400 text-xs; }
        .file-date { @apply text-zinc-500 text-xs; }
        .action-btn { @apply px-3 py-1 rounded text-xs font-medium transition; }
        .btn-download { @apply bg-blue-600 hover:bg-blue-700 text-white; }
        .btn-delete { @apply bg-red-600 hover:bg-red-700 text-white; }
        .btn-share { @apply bg-green-600 hover:bg-green-700 text-white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">File Manager</h1>
            <div class="flex space-x-4">
                <button onclick="refreshFiles()" class="action-btn bg-purple-600 hover:bg-purple-700 text-white">
                    üîÑ Refresh
                </button>
                <a href="index.html" class="action-btn bg-zinc-600 hover:bg-zinc-700 text-white">
                    üì§ Upload
                </a>
            </div>
        </div>

        <div id="file-list" class="file-grid">
            <!-- Files will be loaded here -->
        </div>

        <div id="loading" class="text-center text-zinc-400 py-8">
            Loading files...
        </div>
    </div>

    <script>
        // File type icons
        const fileIcons = {
            'image': 'üñºÔ∏è',
            'video': 'üé•',
            'audio': 'üéµ',
            'document': 'üìÑ',
            'archive': 'üì¶',
            'code': 'üíª',
            'default': 'üìÅ'
        };

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'].includes(ext)) return fileIcons.image;
            if (['mp4', 'avi', 'mov', 'wmv', 'flv'].includes(ext)) return fileIcons.video;
            if (['mp3', 'wav', 'flac', 'aac'].includes(ext)) return fileIcons.audio;
            if (['pdf', 'doc', 'docx', 'txt', 'rtf'].includes(ext)) return fileIcons.document;
            if (['zip', 'rar', '7z', 'tar', 'gz'].includes(ext)) return fileIcons.archive;
            if (['js', 'html', 'css', 'py', 'java', 'cpp'].includes(ext)) return fileIcons.code;
            return fileIcons.default;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        async function loadFiles() {
            try {
                const response = await fetch('list-files.php');
                const files = await response.json();
                
                const fileList = document.getElementById('file-list');
                const loading = document.getElementById('loading');
                
                loading.style.display = 'none';
                
                if (files.length === 0) {
                    fileList.innerHTML = '<div class="col-span-full text-center text-zinc-400 py-8">No files uploaded yet</div>';
                    return;
                }

                fileList.innerHTML = files.map(file => `
                    <div class="file-card">
                        <div class="file-icon text-4xl">${getFileIcon(file.name)}</div>
                        <div class="file-name" title="${file.name}">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                        <div class="file-date">${formatDate(file.date)}</div>
                        <div class="flex space-x-2 mt-3">
                            <button onclick="downloadFile('${file.name}')" class="action-btn btn-download">
                                ‚¨áÔ∏è
                            </button>
                            <button onclick="shareFile('${file.name}')" class="action-btn btn-share">
                                üîó
                            </button>
                            <button onclick="deleteFile('${file.name}')" class="action-btn btn-delete">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading files:', error);
                document.getElementById('loading').innerHTML = '<div class="text-red-400">Error loading files</div>';
            }
        }

        function downloadFile(filename) {
            window.open(`download.php?file=${encodeURIComponent(filename)}`, '_blank');
        }

        function shareFile(filename) {
            const url = `${window.location.origin}/uploads/${filename}`;
            navigator.clipboard.writeText(url).then(() => {
                alert('Share link copied to clipboard!');
            });
        }

        async function deleteFile(filename) {
            if (!confirm(`Are you sure you want to delete ${filename}?`)) return;
            
            try {
                const response = await fetch('delete.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename })
                });
                
                if (response.ok) {
                    loadFiles(); // Refresh the list
                } else {
                    alert('Error deleting file');
                }
            } catch (error) {
                console.error('Error deleting file:', error);
                alert('Error deleting file');
            }
        }

        function refreshFiles() {
            document.getElementById('loading').style.display = 'block';
            loadFiles();
        }

        // Load files on page load
        loadFiles();
    </script>
</body>
</html>
