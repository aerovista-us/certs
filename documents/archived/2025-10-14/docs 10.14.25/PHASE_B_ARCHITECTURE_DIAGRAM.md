# Phase B: Browser Workspaces - Architecture Diagram

## 🏗️ **High-Level Architecture Overview**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              AeroVista Phase B Architecture                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           User Access Layer                              │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Desktop   │  │   Mobile    │  │   Tablet    │  │   Any       │   │   │
│  │  │  Browser    │  │  Browser    │  │  Browser    │  │  Browser    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Traefik Gateway Layer                            │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                    Traefik Reverse Proxy                         │   │   │
│  │  │              (SSL Termination, Load Balancing)                   │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Authentication Layer                             │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                        Authelia SSO                              │   │   │
│  │  │              (Single Sign-On, MFA, Session Management)           │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Workspace Services Layer                         │   │
│  │                                                                         │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐ │   │
│  │  │   Remote        │  │   Development   │  │    Interactive          │ │   │
│  │  │   Desktop       │  │   Environments  │  │    Computing            │ │   │
│  │  │                 │  │                 │  │                         │ │   │
│  │  │ ┌─────────────┐ │  │ ┌─────────────┐ │  │ ┌─────────────┐         │ │   │
│  │  │ │ VNC Server  │ │  │ │Code Server  │ │  │ │  Jupyter    │         │ │   │
│  │  │ │ (TigerVNC)  │ │  │ │ (VS Code)   │ │  │ │ (Notebooks) │         │ │   │
│  │  │ └─────────────┘ │  │ └─────────────┘ │  │ └─────────────┘         │ │   │
│  │  │                 │  │                 │  │                         │ │   │
│  │  │ ┌─────────────┐ │  │ ┌─────────────┐ │  │ ┌─────────────┐         │ │   │
│  │  │ │   NoVNC     │ │  │ │  Guacamole  │ │  │ │  RStudio    │         │ │   │
│  │  │ │ (Web VNC)   │ │  │ │ (HTML5 RDP) │ │  │ │ (R Dev)     │         │ │   │
│  │  │ └─────────────┘ │  │ └─────────────┘ │  │ └─────────────┘         │ │   │
│  │  │                 │  │                 │  │                         │ │   │
│  │  │ ┌─────────────┐ │  │                 │  │                         │ │   │
│  │  │ │  Guacamole  │ │  │                 │  │                         │ │   │
│  │  │ │ (Multi-Prot)│ │  │                 │  │                         │ │   │
│  │  │ └─────────────┘ │  │                 │  │                         │ │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Infrastructure Layer                              │   │
│  │                                                                         │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐ │   │
│  │  │   File Sharing  │  │   Monitoring    │  │      Storage            │ │   │
│  │  │   System        │  │   Stack         │  │                         │ │   │
│  │  │                 │  │                 │  │                         │ │   │
│  │  │ ┌─────────────┐ │  │ ┌─────────────┐ │  │ ┌─────────────┐         │ │   │
│  │  │ │   Nginx     │ │  │ │   Grafana   │ │  │ │ PostgreSQL  │         │ │   │
│  │  │ │   + PHP     │ │  │ │   + Prom    │ │  │ │   + Redis   │         │ │   │
│  │  │ └─────────────┘ │  │ └─────────────┘ │  │ └─────────────┘         │ │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔗 **Service Communication Flow**

```
User Browser
    │
    ▼
Traefik Gateway (Port 80/443)
    │
    ▼
Authelia Authentication
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│                    Workspace Routing                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  /vnc/     → NoVNC → VNC Server (Desktop)                  │
│  /guac/    → Guacamole → VNC/RDP/SSH                       │
│  /code/    → Code Server → VS Code Environment             │
│  /jupyter/ → Jupyter → Notebook Environment                │
│  /rstudio/ → RStudio → R Development Environment           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
Shared File System (/srv/core/fileshare/uploads/)
    │
    ▼
Monitoring & Logging (Grafana, Prometheus, Uptime Kuma)
```

## 🌐 **Network Architecture**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Docker Networks                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           Gateway Network                               │   │
│  │                        (Public-facing services)                         │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Traefik   │  │   NoVNC     │  │  Guacamole  │  │Code Server  │   │   │
│  │  │  (Gateway)  │  │ (Web VNC)   │  │ (HTML5 RDP) │  │ (VS Code)   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐                                     │   │
│  │  │  Jupyter    │  │  RStudio    │                                     │   │
│  │  │ (Notebooks) │  │ (R Dev)     │                                     │   │
│  │  └─────────────┘  └─────────────┘                                     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           Backend Network                               │   │
│  │                        (Internal services)                              │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ VNC Server  │  │ PostgreSQL  │  │    Redis    │  │File Sharing │   │   │
│  │  │ (TigerVNC)  │  │ (Database)  │  │   (Cache)   │  │   (PHP)     │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Observability Network                            │   │
│  │                        (Monitoring services)                            │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Grafana   │  │ Prometheus  │  │Uptime Kuma  │  │  cAdvisor   │   │   │
│  │  │ (Dashboards)│  │ (Metrics)   │  │ (Health)    │  │ (Container) │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 **Data Flow Architecture**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Data Flow Diagram                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  User Input (Keyboard/Mouse/Touch)                                             │
│           │                                                                     │
│           ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Web Interface Layer                              │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   NoVNC     │  │  Guacamole  │  │Code Server  │  │  Jupyter    │   │   │
│  │  │ (VNC Client)│  │ (RDP Client)│  │ (VS Code)   │  │ (Notebook)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│           │                                                                     │
│           ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Protocol Translation Layer                       │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ VNC Protocol│  │ RDP Protocol│  │ WebSocket   │  │ HTTP/HTTPS  │   │   │
│  │  │ Translation │  │ Translation │  │ Streaming   │  │ API Calls   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│           │                                                                     │
│           ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Backend Services Layer                           │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ VNC Server  │  │  Desktop    │  │Code Server  │  │  Jupyter    │   │   │
│  │  │ (TigerVNC)  │  │ Environment │  │ Backend     │  │ Backend     │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│           │                                                                     │
│           ▼                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Storage & Data Layer                             │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ File System │  │ PostgreSQL  │  │    Redis    │  │User Data    │   │   │
│  │  │ (Shared)    │  │ (Metadata)  │  │ (Sessions)  │  │ (Workspace) │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔐 **Security Architecture**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Security Layers                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Network Security                                 │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Tailscale   │  │   Firewall  │  │   VPN       │  │   TLS/SSL   │   │   │
│  │  │ (Mesh VPN)  │  │ (iptables)  │  │ (Encryption)│  │ (HTTPS)     │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Authentication Security                          │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │  Authelia   │  │   MFA       │  │   SSO       │  │   Session   │   │   │
│  │  │ (Identity)  │  │ (2FA/TOTP)  │  │ (Single)    │  │ Management  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Application Security                             │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Input     │  │   Output    │  │   Access    │  │   Audit     │   │   │
│  │  │ Validation  │  │ Sanitization│  │   Control   │  │   Logging   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Data Security                                    │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Encryption  │  │   Backup    │  │   Access    │  │   Privacy   │   │   │
│  │  │ (At Rest)   │  │ (Encrypted) │  │   Logs      │  │ (GDPR)      │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📊 **Performance Architecture**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Performance Optimization                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Load Balancing                                  │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Traefik   │  │   Round     │  │   Health    │  │   Auto      │   │   │
│  │  │ (Gateway)   │  │   Robin     │  │   Checks    │  │   Scaling   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Resource Management                              │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   CPU       │  │   Memory    │  │   Storage   │  │   Network   │   │   │
│  │  │   Limits    │  │   Limits    │  │   Limits    │  │   Limits    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Caching Strategy                                 │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Redis     │  │   Browser   │  │   CDN       │  │   Static    │   │   │
│  │  │ (Sessions)  │  │   Cache     │  │   Cache     │  │   Assets    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Monitoring & Alerting                           │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Grafana   │  │ Prometheus  │  │   Alerts    │  │   Metrics   │   │   │
│  │  │ (Dashboards)│  │ (Collection)│  │ (Real-time) │  │ (Custom)    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🎯 **Integration Points**

### **File Sharing Integration**
```
File Sharing System
        │
        ▼
┌─────────────────────────────────────────────────────────────┐
│                    Shared Storage                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Upload    │  │   Download  │  │   Sync      │         │
│  │   Directory │  │   Directory │  │   Directory │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────┐
│                Workspace Access Points                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   VNC       │  │   Code      │  │  Jupyter    │         │
│  │   Desktop   │  │   Server    │  │  Notebooks  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### **Monitoring Integration**
```
Monitoring Stack
        │
        ▼
┌─────────────────────────────────────────────────────────────┐
│                    Metrics Collection                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Service   │  │   Resource  │  │   User      │         │
│  │   Health    │  │   Usage     │  │   Activity  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────┐
│                    Dashboard Display                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Grafana   │  │   Alerts    │  │   Reports   │         │
│  │ (Real-time) │  │ (Critical)  │  │ (Analytics) │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

*This architecture diagram provides a comprehensive visual overview of Phase B implementation, showing how all components integrate together to create a seamless "work from any browser" experience.*
