PS C:\Users\trcam> scp "build files/media-backup.sh" glyph@192.168.7.209:~/media-backup.sh
C:\WINDOWS\System32\OpenSSH\scp.exe: stat local "build files/media-backup.sh": No such file or directory
PS C:\Users\trcam> scp "build files/media-backup.service" glyph@192.168.7.209:~/media-backup.service
C:\WINDOWS\System32\OpenSSH\scp.exe: stat local "build files/media-backup.service": No such file or directory
PS C:\Users\trcam> scp "build files/media-backup.timer" glyph@192.168.7.209:~/media-backup.timer
C:\WINDOWS\System32\OpenSSH\scp.exe: stat local "build files/media-backup.timer": No such file or directory
PS C:\Users\trcam> cd D:\NeXuS\NXCore-Control
PS D:\NeXuS\NXCore-Control> scp "build files/media-backup.sh" glyph@192.168.7.209:~/media-backup.sh
glyph@192.168.7.209's password:
media-backup.sh                                                                       100% 1025   166.8KB/s   00:00
PS D:\NeXuS\NXCore-Control> scp "build files/media-backup.service" glyph@192.168.7.209:~/media-backup.service
glyph@192.168.7.209's password:
media-backup.service                                                                  100%  109    21.3KB/s   00:00
PS D:\NeXuS\NXCore-Control> scp "build files/media-backup.timer" glyph@192.168.7.209:~/media-backup.timer
glyph@192.168.7.209's password:
Permission denied, please try again.
glyph@192.168.7.209's password:
Permission denied, please try again.
glyph@192.168.7.209's password:
media-backup.timer                                                                    100%  145    20.2KB/s   00:00
PS D:\NeXuS\NXCore-Control> .\scripts\ps\deploy-containers.ps1 -Service traefik
glyph@192.168.7.209's password:
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
glyph@192.168.7.209's password:
traefik-dynamic.yml                                                                   100% 1218   237.9KB/s   00:00
glyph@192.168.7.209's password:
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
glyph@192.168.7.209's password:
compose-traefik.yml                                                                   100% 1363   221.8KB/s   00:00
glyph@192.168.7.209's password:
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
glyph@192.168.7.209's password:
1e590b14c6ea4b297f98ac1fa51418c733ab6f32928025764203fe56fa1b1104
glyph@192.168.7.209's password:
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
âœ… Deployment done.
PS D:\NeXuS\NXCore-Control> ssh -tt glyph@192.168.7.209 "sudo .\scripts\ps\deploy-containers.ps1"
glyph@192.168.7.209's password:
[sudo] password for glyph:
sudo: .scriptspsdeploy-containers.ps1: command not found
Connection to 192.168.7.209 closed.
PS D:\NeXuS\NXCore-Control> # copy the folder (or git clone it on the server)
PS D:\NeXuS\NXCore-Control> scp -r .\scripts glyph@192.168.7.209:/home/glyph/NXCore-Control/
glyph@192.168.7.209's password:
C:\WINDOWS\System32\OpenSSH\scp.exe: realpath /home/glyph/NXCore-Control/: No such file
C:\WINDOWS\System32\OpenSSH\scp.exe: upload "/home/glyph/NXCore-Control/": path canonicalization failed
C:\WINDOWS\System32\OpenSSH\scp.exe: failed to upload directory ./scripts to /home/glyph/NXCore-Control/
PS D:\NeXuS\NXCore-Control>
PS D:\NeXuS\NXCore-Control> # run the script over ssh
PS D:\NeXuS\NXCore-Control> ssh -tt glyph@192.168.7.209 "pwsh -File ~/NXCore-Control/scripts/ps/deploy-containers.ps1 -Service traefik"
glyph@192.168.7.209's password:
bash: line 1: pwsh: command not found
Connection to 192.168.7.209 closed.
PS D:\NeXuS\NXCore-Control> .\scripts\ps\deploy-containers.ps1 -Service traefik
glyph@192.168.7.209's password:
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
glyph@192.168.7.209's password:
traefik-dynamic.yml                                                                   100% 1218   198.2KB/s   00:00
glyph@192.168.7.209's password:
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
glyph@192.168.7.209's password:
Connection closed by 192.168.7.209 port 22
C:\WINDOWS\System32\OpenSSH\scp.exe: Connection closed
glyph@192.168.7.209's password:
Permission denied, please try again.
glyph@192.168.7.209's password:
glyph@192.168.7.209's password:
glyph@192.168.7.209's password:
âœ… Deployment done.
PS D:\NeXuS\NXCore-Control> ^C
PS D:\NeXuS\NXCore-Control> ^C
PS D:\NeXuS\NXCore-Control> cd D:\NeXuS\NXCore-Control\scripts\ps
PS D:\NeXuS\NXCore-Control\scripts\ps> .\deploy-containers.hardened.ps1 `
>>   -Host glyph@192.168.7.209 `
>>   -Service traefik `
>>   -Compose ..\..\compose-traefik.yml `
>>   -Dynamic ..\..\traefik-dynamic.yml
.\deploy-containers.hardened.ps1 : The term '.\deploy-containers.hardened.ps1' is not recognized as the name of a
cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify
that the path is correct and try again.
At line:1 char:1
+ .\deploy-containers.hardened.ps1 `
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (.\deploy-containers.hardened.ps1:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

PS D:\NeXuS\NXCore-Control\scripts\ps> ls


    Directory: D:\NeXuS\NXCore-Control\scripts\ps


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        10/13/2025  12:35 AM           2622 deploy-containers.ps1
-a----        10/11/2025   5:02 PM           2988 sync-config.ps1
------        10/11/2025   8:14 PM            480 backup-nxcore.ps1


PS D:\NeXuS\NXCore-Control\scripts\ps> ls


    Directory: D:\NeXuS\NXCore-Control\scripts\ps


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        10/13/2025  12:35 AM           2622 deploy-containers.ps1
-a----        10/11/2025   5:02 PM           2988 sync-config.ps1
------        10/11/2025   8:14 PM            480 backup-nxcore.ps1
-a----        10/13/2025   1:41 AM           4065 deploy-containers.hardened.ps1
-a----        10/12/2025   8:04 PM           5066 setup_workstation.ps1
-a----        10/13/2025   1:41 AM            711 deploy-containers.original.txt


PS D:\NeXuS\NXCore-Control\scripts\ps> Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force
PS D:\NeXuS\NXCore-Control\scripts\ps> & .\deploy-containers.hardened.ps1 `
>>   -Host 'glyph@192.168.7.209' `
>>   -Service 'traefik' `
>>   -Compose '..\..\compose-traefik.yml' `
>>   -Dynamic '..\..\traefik-dynamic.yml' `
>>   -UseTTY
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.ps1:56 char:19
+   & scp $Compose "$Host:$homeCompose"
+                   ~~~~~~
Variable reference is not valid. ':' was not followed by a valid variable name character. Consider using ${} to
delimit the name.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.ps1:59 char:21
+     & scp $Dynamic "$Host:$homeDynamic"
+                     ~~~~~~
Variable reference is not valid. ':' was not followed by a valid variable name character. Consider using ${} to
delimit the name.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.ps1:107 char:60
+ ... âœ” Deployment complete for $Service on $Host" -ForegroundColor Green
+                                                  ~~~~~~~~~~~~~~~~~~~~~~~~
The string is missing the terminator: ".
    + CategoryInfo          : ParserError: (:) [], ParseException
    + FullyQualifiedErrorId : InvalidVariableReferenceWithDrive

PS D:\NeXuS\NXCore-Control\scripts\ps> Set-ExecutionPolicy -Scope Process Bypass -Force
PS D:\NeXuS\NXCore-Control\scripts\ps> Unblock-File .\deploy-containers.hardened.v2.ps1
Unblock-File : Cannot find path 'D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1' because it does
not exist.
At line:1 char:1
+ Unblock-File .\deploy-containers.hardened.v2.ps1
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (.\deploy-containers.hardened.v2.ps1:String) [Unblock-File], ItemNotFoun
   dException
    + FullyQualifiedErrorId : FileNotFound,Microsoft.PowerShell.Commands.UnblockFileCommand

PS D:\NeXuS\NXCore-Control\scripts\ps>
PS D:\NeXuS\NXCore-Control\scripts\ps> & .\deploy-containers.hardened.v2.ps1 `
>>   -Host 'glyph@192.168.7.209' `
>>   -Service 'traefik' `
>>   -Compose '..\..\compose-traefik.yml' `
>>   -Dynamic '..\..\traefik-dynamic.yml' `
>>   -UseTTY
& : The term '.\deploy-containers.hardened.v2.ps1' is not recognized as the name of a cmdlet, function, script file,
or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and
try again.
At line:1 char:3
+ & .\deploy-containers.hardened.v2.ps1 `
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (.\deploy-containers.hardened.v2.ps1:String) [], CommandNotFoundExceptio
   n
    + FullyQualifiedErrorId : CommandNotFoundException

PS D:\NeXuS\NXCore-Control\scripts\ps> @'
>> <#
>>   deploy-containers.hardened.v2.ps1 — Hardened remote deploy for Linux hosts from Windows
>>   - Uploads compose + dynamic files to HOME on the remote
>>   - Moves them into /opt/<service>/ with sudo
>>   - Creates/uses shared 'gateway' docker network
>>   - Starts the stack with 'docker compose up -d'
>>   - Handles sudo via: (1) NOPASSWD if configured; else (2) -tt interactive; else (3) -S with provided password
>> #>
>>
>> param(
>>   [string]$Host = "glyph@nxcore",
>>   [Parameter(Mandatory=$true)][string]$Service,
>>   [string]$Compose = ".\docker-compose.yml",
>>   [string]$Dynamic = "",
>>   [switch]$UseTTY,
>>   [securestring]$SudoPassword,
>>   [switch]$NoUpload,
>>   [switch]$OnlyUp
>> )
>>
>> $ErrorActionPreference = "Stop"
>>
>> function Get-PlainPassword([securestring]$sec) {
>>   if (-not $sec) { return "" }
>>   $b = [Runtime.InteropServices.Marshal]::SecureStringToBSTR($sec)
>>   try { return [Runtime.InteropServices.Marshal]::PtrToStringAuto($b) } fina
>> ^C
PS D:\NeXuS\NXCore-Control\scripts\ps> @'
>> <#
>>   deploy-containers.hardened.v2.ps1 — Hardened remote deploy for Linux hosts from Windows
>>   - Uploads compose + dynamic files to HOME on the remote
>>   - Moves them into /opt/<service>/ with sudo
>>   - Creates/uses shared 'gateway' docker network
>>   - Starts the stack with 'docker compose up -d'
>>   - Handles sudo via: (1) NOPASSWD if configured; else (2) -tt interactive; else (3) -S with provided password
>> #>
>>
>> param(
>>   [string]$Host = "glyph@nxcore",
>>   [Parameter(Mandatory=$true)][string]$Service,
>>   [string]$Compose = ".\docker-compose.yml",
>>   [string]$Dynamic = "",
>>   [switch]$UseTTY,
>>   [securestring]$SudoPassword,
>>   [switch]$NoUpload,
>>   [switch]$OnlyUp
>> )
>>
>> $ErrorActionPreference = "Stop"
>>
>> function Get-PlainPassword([securestring]$sec) {
>>   if (-not $sec) { return "" }
>>   $b = [Runtime.InteropServices.Marshal]::SecureStringToBSTR($sec)
>>   try { return [Runtime.InteropServices.Marshal]::PtrToStringAuto($b) } finally { [Runtime.InteropServices.Marshal]::ZeroFreeBSTR($b) }
>> }
>>
>> $pw = Get-PlainPassword $SudoPassword
>> $homeCompose = "~/compose-$Service.yml"
>> $homeDynamic = "~/dynamic-$Service.yml"
>> $remoteDir   = "/opt/$Service"
>> $remoteDyn   = "$remoteDir/dynamic"
>>
>> Write-Host "== Deploy $Service to $Host ==" -ForegroundColor Cyan
>>
>> # 1) Upload
>> if (-not $OnlyUp -and -not $NoUpload) {
>>   if (-not (Test-Path $Compose)) { throw "Compose file not found: $Compose" }
>>   & scp $Compose "${Host}:$homeCompose"
>>   if ($LASTEXITCODE -ne 0) { throw "scp compose failed" }
>>   if ($Dynamic -and (Test-Path $Dynamic)) {
>>     & scp $Dynamic "${Host}:$homeDynamic"
>>     if ($LASTEXITCODE -ne 0) { throw "scp dynamic failed" }
>>   }
>> }
>>
>> # 2) Remote prep + move + up
>> $cmd_core = @(
>>   "set -e",
>>   "sudo mkdir -p $remoteDir",
>>   "sudo mkdir -p $remoteDyn",
>>   "[ -f $homeCompose ] && sudo mv $homeCompose $remoteDir/docker-compose.yml || true",
>>   "[ -f $homeDynamic ] && sudo mv $homeDynamic $remoteDyn/mw.yml || true",
>>   "docker network ls | grep -q '\bgateway\b' || sudo docker network create gateway",
>>   "cd $remoteDir",
>>   "sudo docker compose up -d"
>> ) -join " && "
>>
>> function Invoke-SSH($command, [switch]$ForceTTY) {
>>   if ($pw -and -not $ForceTTY) {
>>     # Non-interactive path: pipe sudo password with -S
>>     $wrapped = "echo $pw | sudo -S -v >/dev/null 2>&1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo -S ')
>>     & ssh $Host $wrapped
>>     return $LASTEXITCODE
>>   } elseif ($ForceTTY -or $UseTTY) {
>>     & ssh -tt $Host $command
>>     return $LASTEXITCODE
>>   } else {
>>     # Try without password first (NOPASSWD case)
>>     & ssh $Host $command
>>     return $LASTEXITCODE
>>   }
>> }
>>
>> # Try NOPASSWD path first
>> $rc = Invoke-SSH $cmd_core
>> if ($rc -ne 0) {
>>   Write-Warning "NOPASSWD path failed or sudo prompted. Retrying with TTY..."
>>   $rc = Invoke-SSH $cmd_core -ForceTTY
>>   if ($rc -ne 0 -and $pw) {
>>     Write-Warning "TTY path failed or unavailable; retrying with sudo -S piping..."
>>     $rc = Invoke-SSH $cmd_core
>>   }
>> }
>> if ($rc -ne 0) { throw "Remote deploy failed (rc=$rc)" }
>>
>> Write-Host ""
>> Write-Host "Deployment complete for $Service on $Host" -ForegroundColor Green
>> '@ | Set-Content -Encoding UTF8 .\deploy-containers.hardened.v2.ps1
PS D:\NeXuS\NXCore-Control\scripts\ps> Set-ExecutionPolicy -Scope Process Bypass -Force
PS D:\NeXuS\NXCore-Control\scripts\ps> Unblock-File .\deploy-containers.hardened.v2.ps1
PS D:\NeXuS\NXCore-Control\scripts\ps>
PS D:\NeXuS\NXCore-Control\scripts\ps> & .\deploy-containers.hardened.v2.ps1 `
>>   -Host 'glyph@192.168.7.209' `
>>   -Service 'traefik' `
>>   -Compose '..\..\compose-traefik.yml' `
>>   -Dynamic '..\..\traefik-dynamic.yml' `
>>   -UseTTY
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:103
+ ... ll 2>&1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo ...
+                                                             ~~~~~
Unexpected token '"$pw"' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:103
+ ... ev/null 2>&1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | ...
+                                                                  ~
Missing closing ')' in expression.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:108
+ ... 1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo -S ')
+                                                            ~~~~~~~~~~~~~
Unexpected token '' | sudo -S '' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:61 char:32
+   if ($pw -and -not $ForceTTY) {
+                                ~
Missing closing '}' in statement block or type definition.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:60 char:50
+ function Invoke-SSH($command, [switch]$ForceTTY) {
+                                                  ~
Missing closing '}' in statement block or type definition.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:121
+ ... 1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo -S ')
+                                                                         ~
Unexpected token ')' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:66 char:3
+   } elseif ($ForceTTY -or $UseTTY) {
+   ~
Unexpected token '}' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:66 char:36
+   } elseif ($ForceTTY -or $UseTTY) {
+                                    ~
Unexpected token '{' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:69 char:5
+   } else {
+     ~~~~
Unexpected token 'else' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:74 char:1
+ }
+ ~
Unexpected token '}' in expression or statement.
    + CategoryInfo          : ParserError: (:) [], ParseException
    + FullyQualifiedErrorId : UnexpectedToken

PS D:\NeXuS\NXCore-Control\scripts\ps> $pw = Read-Host -AsSecureString "sudo"
sudo: ***********
PS D:\NeXuS\NXCore-Control\scripts\ps> & .\deploy-containers.hardened.v2.ps1 `
>>   -Host 'glyph@192.168.7.209' `
>>   -Service 'traefik' `
>>   -Compose '..\..\compose-traefik.yml' `
>>   -Dynamic '..\..\traefik-dynamic.yml' `
>>   -SudoPassword $pw
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:103
+ ... ll 2>&1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo ...
+                                                             ~~~~~
Unexpected token '"$pw"' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:103
+ ... ev/null 2>&1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | ...
+                                                                  ~
Missing closing ')' in expression.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:108
+ ... 1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo -S ')
+                                                            ~~~~~~~~~~~~~
Unexpected token '' | sudo -S '' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:61 char:32
+   if ($pw -and -not $ForceTTY) {
+                                ~
Missing closing '}' in statement block or type definition.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:60 char:50
+ function Invoke-SSH($command, [switch]$ForceTTY) {
+                                                  ~
Missing closing '}' in statement block or type definition.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:63 char:121
+ ... 1 || true; " + ($command -replace 'sudo ', 'echo '"$pw"' | sudo -S ')
+                                                                         ~
Unexpected token ')' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:66 char:3
+   } elseif ($ForceTTY -or $UseTTY) {
+   ~
Unexpected token '}' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:66 char:36
+   } elseif ($ForceTTY -or $UseTTY) {
+                                    ~
Unexpected token '{' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:69 char:5
+   } else {
+     ~~~~
Unexpected token 'else' in expression or statement.
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v2.ps1:74 char:1
+ }
+ ~
Unexpected token '}' in expression or statement.
    + CategoryInfo          : ParserError: (:) [], ParseException
    + FullyQualifiedErrorId : UnexpectedToken

PS D:\NeXuS\NXCore-Control\scripts\ps> @'
>> <#
>>   deploy-containers.hardened.v3.ps1 — Remote deploy to Linux from Windows
>>   - Uploads compose & optional dynamic file to remote HOME
>>   - Moves into /opt/<service>/ with sudo
>>   - Ensures shared docker network "gateway"
>>   - Starts stack with: docker compose up -d
>>   - Sudo handling:
>>       1) NOPASSWD: tries no prompt
>>       2) TTY: -UseTTY to prompt interactively
>>       3) -SudoPassword: pipes via sudo -S (non-interactive)
>> #>
>>
>> param(
>>   [string]$Host = "glyph@nxcore",
>>   [Parameter(Mandatory=$true)][string]$Service,
>>   [string]$Compose = ".\docker-compose.yml",
>>   [string]$Dynamic = "",
>>   [switch]$UseTTY,
>>   [securestring]$SudoPassword,
>>   [switch]$NoUpload,
>>   [switch]$OnlyUp
>> )
>>
>> $ErrorActionPreference = "Stop"
>>
>> function Get-PlainPassword([securestring]$sec) {
>>   if (-not $sec) { return "" }
>>   $b = [Runtime.InteropServices.Marshal]::SecureStringToBSTR($sec)
>>   try { return [Runtime.InteropServices.Marshal]::PtrToStringAuto($b) } finally { [Runtime.InteropServices.Marshal]::ZeroFreeBSTR($b) }
>> }
>>
>> $pw = Get-PlainPassword $SudoPassword
>> $homeCompose = "~/compose-$Service.yml"
>> $homeDynamic = "~/dynamic-$Service.yml"
>> $remoteDir   = "/opt/$Service"
>> $remoteDyn   = "$remoteDir/dynamic"
>>
>> Write-Host "== Deploy $Service to $Host ==" -ForegroundColor Cyan
>>
>> # 1) Upload
>> if (-not $OnlyUp -and -not $NoUpload) {
>>   if (-not (Test-Path $Compose)) { throw "Compose file not found: $Compose" }
>>   & scp $Compose "${Host}:$homeCompose"
>>   if ($LASTEXITCODE -ne 0) { throw "scp compose failed" }
>>   if ($Dynamic -and (Test-Path $Dynamic)) {
>>     & scp $Dynamic "${Host}:$homeDynamic"
>>     if ($LASTEXITCODE -ne 0) { throw "scp dynamic failed" }
>>   }
>> }
>>
>> # 2) Build remote command
>> $cmd_core_lines = @(
>>   "set -e",
>>   "sudo mkdir -p $remoteDir",
>>   "sudo mkdir -p $remoteDyn",
>>   "[ -f $homeCompose ] && sudo mv $homeCompose $remoteDir/docker-compose.yml || true",
>>   "[ -f $homeDynamic ] && sudo mv $homeDynamic $remoteDyn/mw.yml || true",
>>   "docker network ls | grep -q '\bgateway\b' || sudo docker network create gateway",
>>   "cd $remoteDir",
>>   "sudo docker compose up -d"
>> )
>> $cmd_core = ($cmd_core_lines -join " && ")
>>
>> function Invoke-SSH($command, [switch]$ForceTTY) {
>>   # Path A: try NOPASSWD first (no tty, no password)
>>   if (-not $ForceTTY -and -not $UseTTY -and -not $pw) {
>>     & ssh $using:Host $command
>>     return $LASTEXITCODE
>>   }
>>
>>   # Path B: interactive sudo with TTY
>>   if ($ForceTTY -or $UseTTY) {
>>     & ssh -tt $using:Host $command
>>     return $LASTEXITCODE
>>   }
>>
>>   # Path C: non-interactive sudo using -S (single bash shell)
>>   $escaped = $command.Replace('"','\"')
>>   $wrapped = "printf '%s\n' '" + $using:pw + "' | sudo -S bash -lc \"" + $escaped + "\""
>>   & ssh $using:Host $wrapped
>>   return $LASTEXITCODE
>> }
>>
>> # Try NOPASSWD -> TTY -> sudo -S
>> $rc = Invoke-SSH $cmd_core
>> if ($rc -ne 0) {
>>   Write-Warning "NOPASSWD path failed or sudo prompted. Retrying with TTY..."
>>   $rc = Invoke-SSH $cmd_core -ForceTTY
>>   if ($rc -ne 0 -and $pw) {
>>     Write-Warning "TTY path failed or unavailable; retrying with sudo -S piping..."
>>     $rc = Invoke-SSH $cmd_core
>>   }
>> }
>> if ($rc -ne 0) { throw "Remote deploy failed (rc=$rc)" }
>>
>> Write-Host ""
>> Write-Host "Deployment complete for $Service on $Host" -ForegroundColor Green
>> '@ | Set-Content -Encoding UTF8 .\deploy-containers.hardened.v3.ps1
PS D:\NeXuS\NXCore-Control\scripts\ps> Set-ExecutionPolicy -Scope Process Bypass -Force
PS D:\NeXuS\NXCore-Control\scripts\ps> Unblock-File .\deploy-containers.hardened.v3.ps1
PS D:\NeXuS\NXCore-Control\scripts\ps>
PS D:\NeXuS\NXCore-Control\scripts\ps> & .\deploy-containers.hardened.v3.ps1 `
>>   -Host 'glyph@192.168.7.209' `
>>   -Service 'traefik' `
>>   -Compose '..\..\compose-traefik.yml' `
>>   -Dynamic '..\..\traefik-dynamic.yml' `
>>   -UseTTY
At D:\NeXuS\NXCore-Control\scripts\ps\deploy-containers.hardened.v3.ps1:79 char:86
+ ... f '%s\n' '" + $using:pw + "' | sudo -S bash -lc \"" + $escaped + "\""
+                                                                       ~~~
Unexpected token '\""' in expression or statement.
    + CategoryInfo          : ParserError: (:) [], ParseException
    + FullyQualifiedErrorId : UnexpectedToken

PS D:\NeXuS\NXCore-Control\scripts\ps> # from: D:\NeXuS\NXCore-Control\scripts\ps
PS D:\NeXuS\NXCore-Control\scripts\ps> scp ..\..\compose-traefik.yml  glyph@192.168.7.209:~/compose-traefik.yml
C:\WINDOWS\System32\OpenSSH\scp.exe: stat local "../../compose-traefik.yml": No such file or directory
PS D:\NeXuS\NXCore-Control\scripts\ps> scp ..\..\traefik-dynamic.yml  glyph@192.168.7.209:~/traefik-dynamic.yml
C:\WINDOWS\System32\OpenSSH\scp.exe: stat local "../../traefik-dynamic.yml": No such file or directory
PS D:\NeXuS\NXCore-Control\scripts\ps> ls


    Directory: D:\NeXuS\NXCore-Control\scripts\ps


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        10/13/2025  12:35 AM           2622 deploy-containers.ps1
-a----        10/11/2025   5:02 PM           2988 sync-config.ps1
------        10/11/2025   8:14 PM            480 backup-nxcore.ps1
-a----        10/13/2025   1:41 AM           4065 deploy-containers.hardened.ps1
-a----        10/12/2025   8:04 PM           5066 setup_workstation.ps1
-a----        10/13/2025   1:41 AM            711 deploy-containers.original.txt
-a----        10/13/2025   2:16 AM           3053 deploy-containers.hardened.v2.ps1
-a----        10/13/2025   2:19 AM           3194 deploy-containers.hardened.v3.ps1


PS D:\NeXuS\NXCore-Control\scripts\ps> cd
PS D:\NeXuS\NXCore-Control\scripts\ps> dir


    Directory: D:\NeXuS\NXCore-Control\scripts\ps


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        10/13/2025  12:35 AM           2622 deploy-containers.ps1
-a----        10/11/2025   5:02 PM           2988 sync-config.ps1
------        10/11/2025   8:14 PM            480 backup-nxcore.ps1
-a----        10/13/2025   1:41 AM           4065 deploy-containers.hardened.ps1
-a----        10/12/2025   8:04 PM           5066 setup_workstation.ps1
-a----        10/13/2025   1:41 AM            711 deploy-containers.original.txt
-a----        10/13/2025   2:16 AM           3053 deploy-containers.hardened.v2.ps1
-a----        10/13/2025   2:19 AM           3194 deploy-containers.hardened.v3.ps1


PS D:\NeXuS\NXCore-Control\scripts\ps> cd..
PS D:\NeXuS\NXCore-Control\scripts> ls


    Directory: D:\NeXuS\NXCore-Control\scripts


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        10/11/2025   8:14 PM                ps
------        10/11/2025   8:14 PM             66 ssh-nxcore.bat
------        10/11/2025   8:14 PM            225 scp-to-nxcore.bat


PS D:\NeXuS\NXCore-Control\scripts> cd..
PS D:\NeXuS\NXCore-Control> ls


    Directory: D:\NeXuS\NXCore-Control


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        10/11/2025   8:14 PM                scripts
d-----        10/11/2025   8:14 PM                docker
d-----        10/11/2025   8:14 PM                agent
d-----        10/11/2025   8:14 PM                ai
d-----        10/11/2025   8:14 PM                configs
d-----        10/11/2025   8:14 PM                utils
d-----        10/11/2025   8:14 PM                inventory
d-----        10/11/2025  10:17 PM                apps
d-----        10/11/2025  11:00 PM                aerocoreos_splash
d-----        10/12/2025   6:05 PM                all.in.one.installer
d-----        10/12/2025  11:09 PM                build files
------        10/11/2025   8:14 PM           1251 .cursorrules
-a----        10/13/2025  12:36 AM            751 cursor.json
-a----        10/12/2025  11:22 PM           5589 README.md
------        10/11/2025   8:14 PM            114 .env.example
-a----        10/11/2025  11:25 PM           4473 admin-nav.links.html


PS D:\NeXuS\NXCore-Control> cd docker
PS D:\NeXuS\NXCore-Control\docker> ls


    Directory: D:\NeXuS\NXCore-Control\docker


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
------        10/11/2025   8:14 PM            326 compose-n8n.yml
------        10/11/2025   8:14 PM            288 compose-filebrowser.yml
-a----        10/12/2025   9:32 AM            737 compose-aerocaller.yml
-a----        10/13/2025  12:33 AM           1363 compose-traefik.yml
-a----        10/13/2025  12:34 AM           1218 traefik-dynamic.yml
-a----        10/13/2025  12:34 AM           1201 compose-portainer.yml


PS D:\NeXuS\NXCore-Control\docker> cd..
PS D:\NeXuS\NXCore-Control> $compose = Get-ChildItem -Recurse -File -Filter 'docker-compose.yml' | Where-Object { $_.FullName -match 'server\\gateway' } | Select-Object -First 1
PS D:\NeXuS\NXCore-Control> $dynamic = Get-ChildItem -Recurse -File -Filter 'mw.yml'
PS D:\NeXuS\NXCore-Control> sudo mkdir -p /opt/traefik/dynamic
Sudo is disabled on this machine. To enable it, go to the Developer Settings page in the Settings app
PS D:\NeXuS\NXCore-Control> sudo mv ~/compose-traefik.yml /opt/traefik/docker-compose.yml
Sudo is disabled on this machine. To enable it, go to the Developer Settings page in the Settings app
PS D:\NeXuS\NXCore-Control> sudo mv ~/traefik-dynamic.yml /opt/traefik/dynamic/mw.yml
Sudo is disabled on this machine. To enable it, go to the Developer Settings page in the Settings app
PS D:\NeXuS\NXCore-Control>
PS D:\NeXuS\NXCore-Control> docker network ls | grep -q '\bgateway\b' || sudo docker network create gateway
At line:1 char:43
+ docker network ls | grep -q '\bgateway\b' || sudo docker network crea ...
+                                           ~~
The token '||' is not a valid statement separator in this version.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine

PS D:\NeXuS\NXCore-Control> cd /opt/traefik
cd : Cannot find path 'D:\opt\traefik' because it does not exist.
At line:1 char:1
+ cd /opt/traefik
+ ~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (D:\opt\traefik:String) [Set-Location], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.SetLocationCommand

PS D:\NeXuS\NXCore-Control> sudo docker compose up -d
Sudo is disabled on this machine. To enable it, go to the Developer Settings page in the Settings app
PS D:\NeXuS\NXCore-Control> ssh glyph@192.168.7.209
glyph@192.168.7.209's password:
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-85-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Mon Oct 13 09:33:00 AM UTC 2025

  System load:             0.01
  Usage of /:              9.7% of 97.87GB
  Memory usage:            7%
  Swap usage:              0%
  Temperature:             47.0 C
  Processes:               176
  Users logged in:         1
  IPv4 address for enp1s0: 192.168.7.209
  IPv6 address for enp1s0: fd88:bc9e:4369:1:529a:4cff:fe5b:7db4

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

26 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


Last login: Mon Oct 13 08:00:33 2025 from 192.168.7.209
glyph@nxcore:~$ sudo mkdir -p /opt/traefik/dynamic
sudo mv ~/compose-traefik.yml /opt/traefik/docker-compose.yml
sudo mv ~/traefik-dynamic.yml /opt/traefik/dynamic/mw.yml

docker network ls | grep -q '\bgateway\b' || sudo docker network create gateway
cd /opt/traefik
sudo docker compose up -d

sudo docker ps --filter name=traefik
sudo docker logs -n 50 traefik
[sudo] password for glyph:
mv: cannot stat '/home/glyph/compose-traefik.yml': No such file or directory
WARN[0000] /opt/traefik/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
WARN[0000] a network with name gateway exists but was not created by compose.
Set `external: true` to use an existing network
network gateway was found but has incorrect label com.docker.compose.network set to "" (expected: "gateway")
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
Error response from daemon: No such container: traefik
glyph@nxcore:/opt/traefik$ # make folders
sudo mkdir -p /opt/traefik/dynamic

# write docker-compose.yml (no 'version:', proper external network, stable name)
sudo tee /opt/traefik/docker-compose.yml >/dev/null <<'YAML'
services:
  traefik:
    image: traefik:v3.0
    container_name: traefik
    restart: unless-stopped
    command:
      - --api=false
      - --providers.docker=true
      - --providers.docker.exposedbydefault=false
      - --providers.file.directory=/etc/traefik/dynamic
      - --entrypoints.web.address=:8080
      # For HTTPS later with Tailscale:
      # - --entrypoints.websecure.address=:443
    ports:
      - "8080:8080"
      # And later if you enable websecure:
      # - "443:443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./dynamic:/etc/traefik/dynamic:ro
      # For Tailscale certs later:
      # - /var/lib/tailscale:/var/lib/tailscale:ro
    networks:
      - gateway

YAML      - "admin:REPLACE_WITH_HTPASSWD"  # optional; replace later
glyph@nxcore:/opt/traefik$ # only do rm if nothing else uses 'gateway'
sudo docker network rm gateway 2>/dev/null || true
sudo docker network create gateway

cd /opt/traefik
sudo docker compose up -d

sudo docker ps --filter name=traefik
sudo docker logs --no-log-prefix -n 50 traefik
gateway
3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd
[+] Running 5/5
 ✔ traefik Pulled                                                                                                  6.5s
   ✔ ec99f8b99825 Pull complete                                                                                    1.1s
   ✔ 8168e2be9d20 Pull complete                                                                                    1.3s
   ✔ 4c4266770910 Pull complete                                                                                    5.1s
   ✔ 67e108beaf7a Pull complete                                                                                    5.2s
[+] Running 0/1
 ⠧ Container traefik  Starting                                                                                     0.7s
Error response from daemon: failed to set up container networking: driver failed programming external connectivity on endpoint traefik (4cc630b6f957108917c4d0af9a4e0921a9063699dcba7893a3f4a1d5e1d2c435): Bind for 0.0.0.0:8080 failed: port is already allocated
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
unknown flag: --no-log-prefix

Usage:  docker logs [OPTIONS] CONTAINER

Run 'docker logs --help' for more information
glyph@nxcore:/opt/traefik$ sudo ss -ltnp | grep :8080 || sudo docker ps --format 'table {{.Names}}\t{{.Ports}}' | grep ':8080'
LISTEN 0      4096                                  0.0.0.0:8080       0.0.0.0:*    users:(("docker-proxy",pid=149466,fd=7))
LISTEN 0      4096                                     [::]:8080          [::]:*    users:(("docker-proxy",pid=149473,fd=7))
glyph@nxcore:/opt/traefik$ # all running containers with their published ports
sudo docker ps --format 'table {{.Names}}\t{{.Image}}\t{{.Ports}}'
NAMES           IMAGE                                     PORTS
node_exporter   quay.io/prometheus/node-exporter:latest
watchtower      containrrr/watchtower:latest              8080/tcp
aerocaller      node:18-alpine                            0.0.0.0:4443->4443/tcp, [::]:4443->4443/tcp
coturn          coturn/coturn:latest
filebrowser     filebrowser/filebrowser:latest            0.0.0.0:8080->80/tcp, [::]:8080->80/tcp
n8n             docker.n8n.io/n8nio/n8n:latest            0.0.0.0:5678->5678/tcp, [::]:5678->5678/tcp
glyph@nxcore:/opt/traefik$ # TCP listeners with owning process (kernel + PIDs)
sudo ss -ltnp
# UDP listeners (rarely needed, but handy)
sudo ss -lunp
State       Recv-Q      Send-Q                                    Local Address:Port             Peer Address:Port      Process
LISTEN      0           4096                                         127.0.0.54:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=17))
LISTEN      0           4096                                            0.0.0.0:5678                  0.0.0.0:*          users:(("docker-proxy",pid=93852,fd=7))
LISTEN      0           4096                                       100.115.9.61:9443                  0.0.0.0:*          users:(("tailscaled",pid=104120,fd=28))
LISTEN      0           4096                                       100.115.9.61:9445                  0.0.0.0:*          users:(("tailscaled",pid=104120,fd=30))
LISTEN      0           4096                                            0.0.0.0:4443                  0.0.0.0:*          users:(("docker-proxy",pid=709362,fd=7))
LISTEN      0           4096                                            0.0.0.0:8080                  0.0.0.0:*          users:(("docker-proxy",pid=149466,fd=7))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=48))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=44))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=24))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=12))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=62))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=56))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=32))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=22))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=59))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=53))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=31))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=21))
LISTEN      0           4096                                      127.0.0.53%lo:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=15))
LISTEN      0           4096                                            0.0.0.0:22                    0.0.0.0:*          users:(("sshd",pid=1444,fd=3),("systemd",pid=1,fd=114))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=58))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=50))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=30))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=20))
LISTEN      0           4096                                       100.115.9.61:63555                 0.0.0.0:*          users:(("tailscaled",pid=104120,fd=23))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=54))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=47))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=28))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=18))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=51))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=45))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=26))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=16))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=55))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=49))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=29))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=19))
LISTEN      0           4096                                               [::]:5678                     [::]:*          users:(("docker-proxy",pid=93858,fd=7))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=25))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=34))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=63))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=67))
LISTEN      0           4096                                               [::]:4443                     [::]:*          users:(("docker-proxy",pid=709369,fd=7))
LISTEN      0           4096                                               [::]:8080                     [::]:*          users:(("docker-proxy",pid=149473,fd=7))
LISTEN      0           4096                         [fd7a:115c:a1e0::9901:93e]:38343                    [::]:*          users:(("tailscaled",pid=104120,fd=24))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=27))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=35))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=66))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=68))
LISTEN      0           4096                                                  *:9100                        *:*          users:(("node_exporter",pid=1335096,fd=3))
LISTEN      0           4096                                               [::]:22                       [::]:*          users:(("sshd",pid=1444,fd=4),("systemd",pid=1,fd=116))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=23))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=33))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=61))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=64))
LISTEN      0           4096                         [fd7a:115c:a1e0::9901:93e]:9443                     [::]:*          users:(("tailscaled",pid=104120,fd=29))
LISTEN      0           4096                         [fd7a:115c:a1e0::9901:93e]:9445                     [::]:*          users:(("tailscaled",pid=104120,fd=31))
State       Recv-Q      Send-Q                                    Local Address:Port             Peer Address:Port      Process
UNCONN      0           0                                            127.0.0.54:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=16))
UNCONN      0           0                                         127.0.0.53%lo:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=14))
UNCONN      0           0                                  192.168.7.209%enp1s0:68                    0.0.0.0:*          users:(("systemd-network",pid=937,fd=22))
UNCONN      0           0                                               0.0.0.0:41641                 0.0.0.0:*          users:(("tailscaled",pid=104120,fd=19))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=91))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=90))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=89))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=88))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=87))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=86))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=85))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=84))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=83))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=82))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=81))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=80))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=79))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=78))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=77))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=76))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=75))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=74))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=73))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=72))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=71))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=70))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=69))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=65))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=60))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=57))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=52))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=46))
UNCONN      0           0                                                  [::]:41641                    [::]:*          users:(("tailscaled",pid=104120,fd=18))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=92))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=93))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=94))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=95))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=96))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=97))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=98))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=99))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=100))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=101))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=102))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=103))
glyph@nxcore:/opt/traefik$ # replace 8080 with any port you're curious about
sudo ss -ltnp | grep :8080
LISTEN 0      4096                                  0.0.0.0:8080       0.0.0.0:*    users:(("docker-proxy",pid=149466,fd=7))
LISTEN 0      4096                                     [::]:8080          [::]:*    users:(("docker-proxy",pid=149473,fd=7))
glyph@nxcore:/opt/traefik$ # requires lsof; install once: sudo apt-get install -y lsof
sudo lsof -i -P -n | grep LISTEN
systemd         1            root  114u  IPv4    8682      0t0  TCP *:22 (LISTEN)
systemd         1            root  116u  IPv6    8684      0t0  TCP *:22 (LISTEN)
systemd-r     745 systemd-resolve   15u  IPv4    7778      0t0  TCP 127.0.0.53:53 (LISTEN)
systemd-r     745 systemd-resolve   17u  IPv4    7780      0t0  TCP 127.0.0.54:53 (LISTEN)
sshd         1444            root    3u  IPv4    8682      0t0  TCP *:22 (LISTEN)
sshd         1444            root    4u  IPv6    8684      0t0  TCP *:22 (LISTEN)
docker-pr   93852            root    7u  IPv4  224897      0t0  TCP *:5678 (LISTEN)
docker-pr   93858            root    7u  IPv6  224898      0t0  TCP *:5678 (LISTEN)
tailscale  104120            root   23u  IPv4  241172      0t0  TCP 100.115.9.61:63555 (LISTEN)
tailscale  104120            root   24u  IPv6  241174      0t0  TCP [fd7a:115c:a1e0::9901:93e]:38343 (LISTEN)
tailscale  104120            root   28u  IPv4 8326283      0t0  TCP 100.115.9.61:9443 (LISTEN)
tailscale  104120            root   29u  IPv6 8324990      0t0  TCP [fd7a:115c:a1e0::9901:93e]:9443 (LISTEN)
tailscale  104120            root   30u  IPv4 8318762      0t0  TCP 100.115.9.61:9445 (LISTEN)
tailscale  104120            root   31u  IPv6 8320892      0t0  TCP [fd7a:115c:a1e0::9901:93e]:9445 (LISTEN)
docker-pr  149466            root    7u  IPv4  315354      0t0  TCP *:8080 (LISTEN)
docker-pr  149473            root    7u  IPv6  315355      0t0  TCP *:8080 (LISTEN)
turnserve  268272          nobody   12u  IPv4  574161      0t0  TCP 127.0.0.1:3478 (LISTEN)
turnserve  268272          nobody   16u  IPv4  574162      0t0  TCP 192.168.7.209:3478 (LISTEN)
turnserve  268272          nobody   18u  IPv4  574163      0t0  TCP 172.17.0.1:3478 (LISTEN)
turnserve  268272          nobody   19u  IPv4  574164      0t0  TCP 172.19.0.1:3478 (LISTEN)
turnserve  268272          nobody   20u  IPv4  574165      0t0  TCP 172.18.0.1:3478 (LISTEN)
turnserve  268272          nobody   21u  IPv4  574166      0t0  TCP 172.20.0.1:3478 (LISTEN)
turnserve  268272          nobody   22u  IPv4  574167      0t0  TCP 100.115.9.61:3478 (LISTEN)
turnserve  268272          nobody   23u  IPv6  574168      0t0  TCP [::1]:3478 (LISTEN)
turnserve  268272          nobody   24u  IPv4  575014      0t0  TCP 127.0.0.1:3478 (LISTEN)
turnserve  268272          nobody   25u  IPv6  574169      0t0  TCP [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478 (LISTEN)
turnserve  268272          nobody   26u  IPv4  575015      0t0  TCP 192.168.7.209:3478 (LISTEN)
turnserve  268272          nobody   27u  IPv6  574170      0t0  TCP [fd7a:115c:a1e0::9901:93e]:3478 (LISTEN)
turnserve  268272          nobody   28u  IPv4  575016      0t0  TCP 172.17.0.1:3478 (LISTEN)
turnserve  268272          nobody   29u  IPv4  575017      0t0  TCP 172.19.0.1:3478 (LISTEN)
turnserve  268272          nobody   30u  IPv4  575018      0t0  TCP 172.18.0.1:3478 (LISTEN)
turnserve  268272          nobody   31u  IPv4  575019      0t0  TCP 172.20.0.1:3478 (LISTEN)
turnserve  268272          nobody   32u  IPv4  575020      0t0  TCP 100.115.9.61:3478 (LISTEN)
turnserve  268272          nobody   33u  IPv6  575021      0t0  TCP [::1]:3478 (LISTEN)
turnserve  268272          nobody   34u  IPv6  575022      0t0  TCP [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478 (LISTEN)
turnserve  268272          nobody   35u  IPv6  575023      0t0  TCP [fd7a:115c:a1e0::9901:93e]:3478 (LISTEN)
turnserve  268272          nobody   44u  IPv4  575025      0t0  TCP 127.0.0.1:3478 (LISTEN)
turnserve  268272          nobody   45u  IPv4  575026      0t0  TCP 192.168.7.209:3478 (LISTEN)
turnserve  268272          nobody   47u  IPv4  575027      0t0  TCP 172.17.0.1:3478 (LISTEN)
turnserve  268272          nobody   48u  IPv4  576164      0t0  TCP 127.0.0.1:3478 (LISTEN)
turnserve  268272          nobody   49u  IPv4  575028      0t0  TCP 172.19.0.1:3478 (LISTEN)
turnserve  268272          nobody   50u  IPv4  575029      0t0  TCP 172.18.0.1:3478 (LISTEN)
turnserve  268272          nobody   51u  IPv4  576165      0t0  TCP 192.168.7.209:3478 (LISTEN)
turnserve  268272          nobody   53u  IPv4  575030      0t0  TCP 172.20.0.1:3478 (LISTEN)
turnserve  268272          nobody   54u  IPv4  576166      0t0  TCP 172.17.0.1:3478 (LISTEN)
turnserve  268272          nobody   55u  IPv4  576167      0t0  TCP 172.19.0.1:3478 (LISTEN)
turnserve  268272          nobody   56u  IPv4  575031      0t0  TCP 100.115.9.61:3478 (LISTEN)
turnserve  268272          nobody   58u  IPv4  576168      0t0  TCP 172.18.0.1:3478 (LISTEN)
turnserve  268272          nobody   59u  IPv4  576169      0t0  TCP 172.20.0.1:3478 (LISTEN)
turnserve  268272          nobody   61u  IPv6  575032      0t0  TCP [::1]:3478 (LISTEN)
turnserve  268272          nobody   62u  IPv4  576170      0t0  TCP 100.115.9.61:3478 (LISTEN)
turnserve  268272          nobody   63u  IPv6  575033      0t0  TCP [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478 (LISTEN)
turnserve  268272          nobody   64u  IPv6  576171      0t0  TCP [::1]:3478 (LISTEN)
turnserve  268272          nobody   66u  IPv6  575034      0t0  TCP [fd7a:115c:a1e0::9901:93e]:3478 (LISTEN)
turnserve  268272          nobody   67u  IPv6  576172      0t0  TCP [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478 (LISTEN)
turnserve  268272          nobody   68u  IPv6  576173      0t0  TCP [fd7a:115c:a1e0::9901:93e]:3478 (LISTEN)
docker-pr  709362            root    7u  IPv4 7195082      0t0  TCP *:4443 (LISTEN)
docker-pr  709369            root    7u  IPv6 7195083      0t0  TCP *:4443 (LISTEN)
node_expo 1335096          nobody    3u  IPv6 8278030      0t0  TCP *:9100 (LISTEN)
glyph@nxcore:/opt/traefik$ sudo docker ps --format '{{.Names}} {{.Ports}}' \
| sed 's/, /\n/g' \
| awk '{printf "%-30s %s\n", $1, $2}'
node_exporter
watchtower                     8080/tcp
aerocaller                     0.0.0.0:4443->4443/tcp
[::]:4443->4443/tcp
coturn
filebrowser                    0.0.0.0:8080->80/tcp
[::]:8080->80/tcp
n8n                            0.0.0.0:5678->5678/tcp
[::]:5678->5678/tcp
glyph@nxcore:/opt/traefik$ echo '=== CONTAINERS ==='
sudo docker ps --format 'table {{.Names}}\t{{.Image}}\t{{.Ports}}'

echo
echo '=== TCP LISTENERS (by process) ==='
sudo ss -ltnp

echo
echo '=== UDP LISTENERS (by process) ==='
sudo ss -lunp
=== CONTAINERS ===
NAMES           IMAGE                                     PORTS
node_exporter   quay.io/prometheus/node-exporter:latest
watchtower      containrrr/watchtower:latest              8080/tcp
aerocaller      node:18-alpine                            0.0.0.0:4443->4443/tcp, [::]:4443->4443/tcp
coturn          coturn/coturn:latest
filebrowser     filebrowser/filebrowser:latest            0.0.0.0:8080->80/tcp, [::]:8080->80/tcp
n8n             docker.n8n.io/n8nio/n8n:latest            0.0.0.0:5678->5678/tcp, [::]:5678->5678/tcp

=== TCP LISTENERS (by process) ===
State       Recv-Q      Send-Q                                    Local Address:Port             Peer Address:Port      Process
LISTEN      0           4096                                         127.0.0.54:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=17))
LISTEN      0           4096                                            0.0.0.0:5678                  0.0.0.0:*          users:(("docker-proxy",pid=93852,fd=7))
LISTEN      0           4096                                       100.115.9.61:9443                  0.0.0.0:*          users:(("tailscaled",pid=104120,fd=28))
LISTEN      0           4096                                       100.115.9.61:9445                  0.0.0.0:*          users:(("tailscaled",pid=104120,fd=30))
LISTEN      0           4096                                            0.0.0.0:4443                  0.0.0.0:*          users:(("docker-proxy",pid=709362,fd=7))
LISTEN      0           4096                                            0.0.0.0:8080                  0.0.0.0:*          users:(("docker-proxy",pid=149466,fd=7))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=48))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=44))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=24))
LISTEN      0           1024                                          127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=12))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=62))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=56))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=32))
LISTEN      0           1024                                       100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=22))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=59))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=53))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=31))
LISTEN      0           1024                                         172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=21))
LISTEN      0           4096                                      127.0.0.53%lo:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=15))
LISTEN      0           4096                                            0.0.0.0:22                    0.0.0.0:*          users:(("sshd",pid=1444,fd=3),("systemd",pid=1,fd=114))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=58))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=50))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=30))
LISTEN      0           1024                                         172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=20))
LISTEN      0           4096                                       100.115.9.61:63555                 0.0.0.0:*          users:(("tailscaled",pid=104120,fd=23))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=54))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=47))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=28))
LISTEN      0           1024                                         172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=18))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=51))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=45))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=26))
LISTEN      0           1024                                      192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=16))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=55))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=49))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=29))
LISTEN      0           1024                                         172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=19))
LISTEN      0           4096                                               [::]:5678                     [::]:*          users:(("docker-proxy",pid=93858,fd=7))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=25))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=34))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=63))
LISTEN      0           1024             [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=67))
LISTEN      0           4096                                               [::]:4443                     [::]:*          users:(("docker-proxy",pid=709369,fd=7))
LISTEN      0           4096                                               [::]:8080                     [::]:*          users:(("docker-proxy",pid=149473,fd=7))
LISTEN      0           4096                         [fd7a:115c:a1e0::9901:93e]:38343                    [::]:*          users:(("tailscaled",pid=104120,fd=24))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=27))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=35))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=66))
LISTEN      0           1024                         [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=68))
LISTEN      0           4096                                                  *:9100                        *:*          users:(("node_exporter",pid=1335096,fd=3))
LISTEN      0           4096                                               [::]:22                       [::]:*          users:(("sshd",pid=1444,fd=4),("systemd",pid=1,fd=116))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=23))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=33))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=61))
LISTEN      0           1024                                              [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=64))
LISTEN      0           4096                         [fd7a:115c:a1e0::9901:93e]:9443                     [::]:*          users:(("tailscaled",pid=104120,fd=29))
LISTEN      0           4096                         [fd7a:115c:a1e0::9901:93e]:9445                     [::]:*          users:(("tailscaled",pid=104120,fd=31))

=== UDP LISTENERS (by process) ===
State       Recv-Q      Send-Q                                    Local Address:Port             Peer Address:Port      Process
UNCONN      0           0                                            127.0.0.54:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=16))
UNCONN      0           0                                         127.0.0.53%lo:53                    0.0.0.0:*          users:(("systemd-resolve",pid=745,fd=14))
UNCONN      0           0                                  192.168.7.209%enp1s0:68                    0.0.0.0:*          users:(("systemd-network",pid=937,fd=22))
UNCONN      0           0                                               0.0.0.0:41641                 0.0.0.0:*          users:(("tailscaled",pid=104120,fd=19))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=91))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=90))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=89))
UNCONN      0           0                                          100.115.9.61:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=88))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=87))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=86))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=85))
UNCONN      0           0                                            172.20.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=84))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=83))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=82))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=81))
UNCONN      0           0                                            172.18.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=80))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=79))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=78))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=77))
UNCONN      0           0                                            172.19.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=76))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=75))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=74))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=73))
UNCONN      0           0                                            172.17.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=72))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=71))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=70))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=69))
UNCONN      0           0                                         192.168.7.209:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=65))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=60))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=57))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=52))
UNCONN      0           0                                             127.0.0.1:3478                  0.0.0.0:*          users:(("turnserver",pid=268272,fd=46))
UNCONN      0           0                                                  [::]:41641                    [::]:*          users:(("tailscaled",pid=104120,fd=18))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=92))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=93))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=94))
UNCONN      0           0                                                 [::1]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=95))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=96))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=97))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=98))
UNCONN      0           0                [fd88:bc9e:4369:1:529a:4cff:fe5b:7db4]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=99))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=100))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=101))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=102))
UNCONN      0           0                            [fd7a:115c:a1e0::9901:93e]:3478                     [::]:*          users:(("turnserver",pid=268272,fd=103))
glyph@nxcore:/opt/traefik$ # stop filebrowser (it’s the one holding 8080)
sudo docker stop filebrowser

# try Traefik again
cd /opt/traefik
sudo docker compose up -d
sudo docker logs -n 50 traefik
filebrowser
[+] Running 1/1
 ✔ Container traefik  Started                                                                                      0.2s
glyph@nxcore:/opt/traefik$ # create a simple compose for filebrowser routed by Traefik
sudo mkdir -p /opt/filebrowser
sudo tee /opt/filebrowser/docker-compose.yml >/dev/null <<'YAML'
services:
  filebrowser:
    image: filebrowser/filebrowser:latest
    container_name: filebrowser
    restart: unless-stopped
    volumes:
      - /srv/media:/srv                # adjust to your media path
      - ./config:/config
    networks:
      - gateway
    labels:
      - traefik.enable=true
      - traefik.http.routers.filebrowser.rule=Host(`files.nxcore`)      # use your MagicDNS host
      - traefik.http.routers.filebrowser.entrypoints=web
      - traefik.http.routers.filebrowser.middlewares=tailnet-only
      - traefik.http.services.filebrowser.loadbalancer.server.port=80

networks:
  gateway:
    external: true
    name: gateway
YAML

cd /opt/filebrowser
sudo docker compose up -d
[+] Running 1/1
 ✘ Container filebrowser  Error response from daemon: Conflict. The container name "/fi...                         0.0s
Error response from daemon: Conflict. The container name "/filebrowser" is already in use by container "9c844f676bed269dd8498b65e9f485fd75c28d3630275ab040bdfcc94462f2d7". You have to remove (or rename) that container to be able to reuse that name.
glyph@nxcore:/opt/filebrowser$ # see mounts/volumes used by the existing container
sudo docker inspect filebrowser --format '{{range .Mounts}}{{println .Source "->" .Destination}}{{end}}'
/srv/core -> /srv
/srv/core/filebrowser -> /database
/srv/core/filebrowser/config -> /config

glyph@nxcore:/opt/filebrowser$ sudo docker stop filebrowser
sudo docker rm filebrowser
filebrowser
filebrowser
glyph@nxcore:/opt/filebrowser$ cd /opt/traefik
sudo docker compose up -d
sudo docker ps --filter name=traefik
sudo docker logs -n 30 traefik
[+] Running 1/1
 ✔ Container traefik  Running                                                                                      0.0s
CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS         PORTS                                                 NAMES
486fef466062   traefik:v3.0   "/entrypoint.sh --ap…"   10 minutes ago   Up 3 minutes   80/tcp, 0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp   traefik
glyph@nxcore:/opt/traefik$ sudo mkdir -p /opt/filebrowser
sudo tee /opt/filebrowser/docker-compose.yml >/dev/null <<'YAML'
services:
  filebrowser:
    image: filebrowser/filebrowser:latest
    container_name: filebrowser
    restart: unless-stopped
    volumes:
      - /srv/core:/srv
      - /srv/core/filebrowser:/database
      - /srv/core/filebrowser/config:/config
    networks:
      - gateway
    labels:
      - traefik.enable=true
      - traefik.http.routers.filebrowser.rule=Host(`files.nxcore`)   # change to your MagicDNS host if you want
      - traefik.http.routers.filebrowser.entrypoints=web
      - traefik.http.routers.filebrowser.middlewares=tailnet-only
      - traefik.http.services.filebrowser.loadbalancer.server.port=80

networks:
  gateway:
    external: true
    name: gateway
YAML

cd /opt/filebrowser
sudo docker compose up -d
[+] Running 1/1
 ✔ Container filebrowser  Started                                                                                  0.2s
glyph@nxcore:/opt/filebrowser$ # Traefik up?
sudo docker ps --filter name=traefik

# FileBrowser up and NOT publishing a host port?
sudo docker ps --filter name=filebrowser --format 'table {{.Names}}\t{{.Ports}}'
CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS         PORTS                                                 NAMES
486fef466062   traefik:v3.0   "/entrypoint.sh --ap…"   10 minutes ago   Up 4 minutes   80/tcp, 0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp   traefik
NAMES         PORTS
filebrowser   80/tcp
glyph@nxcore:/opt/filebrowser$ sudo docker ps --format 'table {{.Names}}\t{{.Image}}\t{{.Ports}}'
NAMES           IMAGE                                     PORTS
filebrowser     filebrowser/filebrowser:latest            80/tcp
traefik         traefik:v3.0                              80/tcp, 0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp
node_exporter   quay.io/prometheus/node-exporter:latest
watchtower      containrrr/watchtower:latest              8080/tcp
aerocaller      node:18-alpine                            0.0.0.0:4443->4443/tcp, [::]:4443->4443/tcp
coturn          coturn/coturn:latest
n8n             docker.n8n.io/n8nio/n8n:latest            0.0.0.0:5678->5678/tcp, [::]:5678->5678/tcp
glyph@nxcore:/opt/filebrowser$ glyph@nxcore:/opt/filebrowser$ sudo docker ps --format 'table {{.Names}}\t{{.Image}}\t{{.Ports}}'
NAMES           IMAGE                                     PORTS
filebrowser     filebrowser/filebrowser:latest            80/tcp
traefik         traefik:v3.0                              80/tcp, 0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp
node_exporter   quay.io/prometheus/node-exporter:latest
watchtower      containrrr/watchtower:latest              8080/tcp
aerocaller      node:18-alpine                            0.0.0.0:4443->4443/tcp, [::]:4443->4443/tcp
coturn          coturn/coturn:latest
n8n             docker.n8n.io/n8nio/n8n:latest            0.0.0.0:5678->5678/tcp, [::]:5678->5678/tcp
glyph@nxcore:/opt/filebrowser$curl -H "Host: files.nxcore" http://127.0.0.1:8080/
-bash: glyph@nxcore:/opt/filebrowser$: No such file or directory
NAMES: command not found
filebrowser: command not found
-bash: 8080/tcp,: No such file or directory
node_exporter: command not found
watchtower: command not found
-bash: 4443/tcp,: No such file or directory
Command 'coturn' not found, but can be installed with:
sudo apt install coturn
-bash: 5678/tcp,: No such file or directory
-bash: glyph@nxcore:/opt/filebrowser: No such file or directory
glyph@nxcore:/opt/filebrowser$ curl -i -H 'Host: files.nxcore' http://127.0.0.1:8080/
HTTP/1.1 404 Not Found
Content-Type: text/plain; charset=utf-8
X-Content-Type-Options: nosniff
Date: Mon, 13 Oct 2025 09:50:17 GMT
Content-Length: 19

404 page not found
glyph@nxcore:/opt/filebrowser$ sudo sed -i 's/middlewares=tailnet-only/middlewares=tailnet-only@file/' /opt/filebrowser/docker-compose.yml
glyph@nxcore:/opt/filebrowser$ cd /opt/filebrowser
sudo docker compose up -d
[+] Running 1/1
 ✔ Container filebrowser  Started                                                                                  0.3s
glyph@nxcore:/opt/filebrowser$ curl -i -H 'Host: files.nxcore' http://127.0.0.1:8080/
HTTP/1.1 403 Forbidden
Date: Mon, 13 Oct 2025 09:53:03 GMT
Content-Length: 9

Forbiddenglyph@nxcore:/opt/filebrowser$ tailscale ip -4
100.115.9.61
glyph@nxcore:/opt/filebrowser$ tailscale status --self
100.115.9.61    nxcore               trcamach@    linux   -
100.96.78.9     aerocoreos           trcamach@    linux   -
100.112.151.67  av-dsktp-o6          trcamach@    windows active; direct 192.168.7.222:41641, tx 3985573460 rx 3613667980
100.105.47.121  av-lsv-o1-linux      trcamach@    linux   offline
100.100.239.23  av-lsv-o1            trcamach@    windows offline
100.102.151.96  av-o1                trcamach@    windows offline
100.67.36.79    billbox-samsung-sm-x900 trcamach@    android offline
100.121.178.43  bytecore             trcamach@    linux   offline
100.76.201.75   hq-central           trcamach@    windows active; direct 192.168.7.185:41641, tx 46267124 rx 2112996
100.88.255.127  j-phone-15           trcamach@    iOS     -
100.86.228.64   jay-machine          trcamach@    windows offline
100.99.174.1    pocket-samsung-sm-s928u trcamach@    android offline
100.86.32.108   samsung-sm-a156u     billyhendrickson18@ android offline
glyph@nxcore:/opt/filebrowser$ sudo docker inspect filebrowser --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

sudo docker logs -n 200 traefik | egrep -i 'router|filebrowser|entrypoint|error|middleware|loaded'
[sudo] password for glyph:
com.docker.compose.config-hash = 29e93fb65f5e54f4f578ed10fd5b52232ee13d342f68cacabc4abed8a05b0073
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:3d55f9a1b31ccd9e4ad9d3a262e754450d75103c226906fce3100d9198b70a70
com.docker.compose.oneoff = False
com.docker.compose.project = filebrowser
com.docker.compose.project.config_files = /opt/filebrowser/docker-compose.yml
com.docker.compose.project.working_dir = /opt/filebrowser
com.docker.compose.replace = filebrowser
com.docker.compose.service = filebrowser
com.docker.compose.version = 2.40.0
org.opencontainers.image.created = 2025-09-25T15:23:29Z
org.opencontainers.image.name = filebrowser
org.opencontainers.image.revision = 878cdfbc52bdb4c4385f24904a87927f852cb907
org.opencontainers.image.source = https://github.com/filebrowser/filebrowser
org.opencontainers.image.version = 2.44.0
traefik.enable = true
traefik.http.routers.filebrowser.entrypoints = web
traefik.http.routers.filebrowser.middlewares = tailnet-only@file
traefik.http.routers.filebrowser.rule = Host(`files.nxcore`)
traefik.http.services.filebrowser.loadbalancer.server.port = 80

2025-10-13T09:45:51Z ERR error="middleware \"tailnet-only@docker\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T10:05:24Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:53706: i/o timeout"
2025-10-13T10:16:03Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:50754: i/o timeout"
glyph@nxcore:/opt/filebrowser$ # A) What labels does the running filebrowser have?
sudo docker inspect filebrowser --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

# B) Did Traefik create a router for files.av?
sudo docker logs -n 200 traefik | egrep -i 'filebrowser|router|rule|entrypoint|error'

# C) Are both on the same network?
sudo docker inspect traefik --format '{{json .NetworkSettings.Networks}}'
sudo docker inspect filebrowser --format '{{json .NetworkSettings.Networks}}'
com.docker.compose.config-hash = 29e93fb65f5e54f4f578ed10fd5b52232ee13d342f68cacabc4abed8a05b0073
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:3d55f9a1b31ccd9e4ad9d3a262e754450d75103c226906fce3100d9198b70a70
com.docker.compose.oneoff = False
com.docker.compose.project = filebrowser
com.docker.compose.project.config_files = /opt/filebrowser/docker-compose.yml
com.docker.compose.project.working_dir = /opt/filebrowser
com.docker.compose.replace = filebrowser
com.docker.compose.service = filebrowser
com.docker.compose.version = 2.40.0
org.opencontainers.image.created = 2025-09-25T15:23:29Z
org.opencontainers.image.name = filebrowser
org.opencontainers.image.revision = 878cdfbc52bdb4c4385f24904a87927f852cb907
org.opencontainers.image.source = https://github.com/filebrowser/filebrowser
org.opencontainers.image.version = 2.44.0
traefik.enable = true
traefik.http.routers.filebrowser.entrypoints = web
traefik.http.routers.filebrowser.middlewares = tailnet-only@file
traefik.http.routers.filebrowser.rule = Host(`files.nxcore`)
traefik.http.services.filebrowser.loadbalancer.server.port = 80

2025-10-13T09:45:51Z ERR error="middleware \"tailnet-only@docker\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T10:05:24Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:53706: i/o timeout"
2025-10-13T10:16:03Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:50754: i/o timeout"
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["traefik","traefik"],"MacAddress":"7a:2c:65:22:e3:99","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"7cf834a1df6fdbb4dd3c5e8f21e7a868ddcbde44270583f7aa9ecc387d12db7c","Gateway":"172.21.0.1","IPAddress":"172.21.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["traefik","486fef466062"]}}
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["filebrowser","filebrowser"],"MacAddress":"0a:49:86:6d:85:07","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"fa5df603406b5dd53ad3bda97ca6933bb6a8c5b40db22a86b29e7d15fb0793e7","Gateway":"172.21.0.1","IPAddress":"172.21.0.3","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["filebrowser","3f23d32bf716"]}}
glyph@nxcore:/opt/filebrowser$ # A) What labels does the running filebrowser have?
sudo docker inspect filebrowser --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

# B) Did Traefik create a router for files.av?
sudo docker logs -n 200 traefik | egrep -i 'filebrowser|router|rule|entrypoint|error'

# C) Are both on the same network?
sudo docker inspect traefik --format '{{json .NetworkSettings.Networks}}'
sudo docker inspect filebrowser --format '{{json .NetworkSettings.Networks}}'
com.docker.compose.config-hash = 29e93fb65f5e54f4f578ed10fd5b52232ee13d342f68cacabc4abed8a05b0073
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:3d55f9a1b31ccd9e4ad9d3a262e754450d75103c226906fce3100d9198b70a70
com.docker.compose.oneoff = False
com.docker.compose.project = filebrowser
com.docker.compose.project.config_files = /opt/filebrowser/docker-compose.yml
com.docker.compose.project.working_dir = /opt/filebrowser
com.docker.compose.replace = filebrowser
com.docker.compose.service = filebrowser
com.docker.compose.version = 2.40.0
org.opencontainers.image.created = 2025-09-25T15:23:29Z
org.opencontainers.image.name = filebrowser
org.opencontainers.image.revision = 878cdfbc52bdb4c4385f24904a87927f852cb907
org.opencontainers.image.source = https://github.com/filebrowser/filebrowser
org.opencontainers.image.version = 2.44.0
traefik.enable = true
traefik.http.routers.filebrowser.entrypoints = web
traefik.http.routers.filebrowser.middlewares = tailnet-only@file
traefik.http.routers.filebrowser.rule = Host(`files.nxcore`)
traefik.http.services.filebrowser.loadbalancer.server.port = 80

2025-10-13T09:45:51Z ERR error="middleware \"tailnet-only@docker\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T10:05:24Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:53706: i/o timeout"
2025-10-13T10:16:03Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:50754: i/o timeout"
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["traefik","traefik"],"MacAddress":"7a:2c:65:22:e3:99","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"7cf834a1df6fdbb4dd3c5e8f21e7a868ddcbde44270583f7aa9ecc387d12db7c","Gateway":"172.21.0.1","IPAddress":"172.21.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["traefik","486fef466062"]}}
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["filebrowser","filebrowser"],"MacAddress":"0a:49:86:6d:85:07","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"fa5df603406b5dd53ad3bda97ca6933bb6a8c5b40db22a86b29e7d15fb0793e7","Gateway":"172.21.0.1","IPAddress":"172.21.0.3","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["filebrowser","3f23d32bf716"]}}
glyph@nxcore:/opt/filebrowser$ sudo sed -i \
  -e "s|traefik.http.routers.filebrowser.rule=.*|traefik.http.routers.filebrowser.rule=Host(\`files.av\`) || Host(\`files.aerovista.local\`)|" \
  -e "s|routers.filebrowser.middlewares=.*|routers.filebrowser.middlewares=tailnet-only@file|" \
  /opt/filebrowser/docker-compose.yml
sed: -e expression #1, char 100: unknown option to `s'
glyph@nxcore:/opt/filebrowser$ sudo tee /opt/filebrowser/docker-compose.yml >/dev/null <<'YAML'
services:
  filebrowser:
    image: filebrowser/filebrowser:latest
    container_name: filebrowser
    restart: unless-stopped
    volumes:
      - /srv/core:/srv
      - /srv/core/filebrowser:/database
      - /srv/core/filebrowser/config:/config
    networks:
      - gateway
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.filebrowser.rule=Host(`files.av`) || Host(`files.aerovista.local`)"
      - "traefik.http.routers.filebrowser.entrypoints=web"
      - "traefik.http.routers.filebrowser.middlewares=tailnet-only@file"
      - "traefik.http.services.filebrowser.loadbalancer.server.port=80"

networks:
  gateway:
    external: true
    name: gateway
YAML
glyph@nxcore:/opt/filebrowser$ cd /opt/filebrowser
sudo docker compose up -d
[+] Running 1/1
 ✔ Container filebrowser  Started                                                                                  0.3s
glyph@nxcore:/opt/filebrowser$ sudo docker inspect filebrowser --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'
com.docker.compose.config-hash = 949d545b6bc7eaefee01639dd330bb5eb7300b2a864868e21573e1f65e6f58dc
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:3d55f9a1b31ccd9e4ad9d3a262e754450d75103c226906fce3100d9198b70a70
com.docker.compose.oneoff = False
com.docker.compose.project = filebrowser
com.docker.compose.project.config_files = /opt/filebrowser/docker-compose.yml
com.docker.compose.project.working_dir = /opt/filebrowser
com.docker.compose.replace = filebrowser
com.docker.compose.service = filebrowser
com.docker.compose.version = 2.40.0
org.opencontainers.image.created = 2025-09-25T15:23:29Z
org.opencontainers.image.name = filebrowser
org.opencontainers.image.revision = 878cdfbc52bdb4c4385f24904a87927f852cb907
org.opencontainers.image.source = https://github.com/filebrowser/filebrowser
org.opencontainers.image.version = 2.44.0
traefik.enable = true
traefik.http.routers.filebrowser.entrypoints = web
traefik.http.routers.filebrowser.middlewares = tailnet-only@file
traefik.http.routers.filebrowser.rule = Host(`files.av`) || Host(`files.aerovista.local`)
traefik.http.services.filebrowser.loadbalancer.server.port = 80

glyph@nxcore:/opt/filebrowser$ sudo docker logs -n 120 traefik | egrep -i 'filebrowser|router|rule|entrypoint|error|loaded'
2025-10-13T09:45:51Z ERR error="middleware \"tailnet-only@docker\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T10:05:24Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:53706: i/o timeout"
2025-10-13T10:16:03Z ERR Error while Peeking first byte error="read tcp 172.21.0.2:8080->172.21.0.1:50754: i/o timeout"
glyph@nxcore:/opt/filebrowser$ cd /opt/traefik
sudo docker compose restart traefik
sleep 2
sudo docker logs --since 2m traefik | egrep -i 'filebrowser|router|rule|entrypoint|error|middleware|loaded' || true
[+] Restarting 1/1
 ✔ Container traefik  Started                                                                                      0.4s
2025-10-13T10:30:41Z ERR error="accept tcp [::]:8080: use of closed network connection" entryPointName=web
2025-10-13T10:30:41Z ERR error="close tcp [::]:8080: use of closed network connection" entryPointName=web
glyph@nxcore:/opt/traefik$ # allow tailscale, docker bridge host, and (optional) localhost for server-side curl
sudo tee /opt/traefik/dynamic/mw.yml >/dev/null <<'YAML'
http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - "100.64.0.0/10"       # Tailscale IPv4
          - "fd7a:115c:a1e0::/48" # Tailscale IPv6
          - "172.21.0.1/32"       # Docker bridge source as seen by Traefik
          - "127.0.0.1/32"        # (optional) local testing
          - "::1/128"             # (optional) local IPv6
YAML

cd /opt/traefik && sudo docker compose restart traefik
[+] Restarting 1/1
 ✔ Container traefik  Started                                                                                      4.3s
glyph@nxcore:/opt/traefik$ sudo mkdir -p /opt/portainer
sudo tee /opt/portainer/docker-compose.yml >/dev/null <<'YAML'
services:
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./data:/data
    networks: [gateway]
    labels:
      - traefik.enable=true
      - traefik.http.routers.portainer.rule=Host(`portainer.av`) || Host(`portainer.aerovista.local`)
      - traefik.http.routers.portainer.entrypoints=web
      - traefik.http.routers.portainer.middlewares=tailnet-only@file
      - traefik.http.services.portainer.loadbalancer.server.port=9000

networks:
  gateway:
    external: true
    name: gateway
YAML

cd /opt/portainer && sudo docker compose up -d
[+] Running 1/1
 ✘ Container portainer  Error response from daemon: Conflict. The container name "/portai...                       0.0s
Error response from daemon: Conflict. The container name "/portainer" is already in use by container "eb50086b638241c6782efd306ea1352e39afb43c4414d2bc4675113292fa8153". You have to remove (or rename) that container to be able to reuse that name.
glyph@nxcore:/opt/portainer$ sudo mkdir -p /opt/n8n
sudo tee /opt/n8n/docker-compose.yml >/dev/null <<'YAML'
services:
  n8n:
    image: docker.n8n.io/n8nio/n8n:latest
    container_name: n8n
    restart: unless-stopped
    environment:
      - N8N_HOST=n8n.av
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://n8n.av:8080/
    volumes:
      - ./data:/home/node/.n8n
    networks: [gateway]
    labels:
      - traefik.enable=true
      - traefik.http.routers.n8n.rule=Host(`n8n.av`) || Host(`n8n.aerovista.local`)
      - traefik.http.routers.n8n.entrypoints=web
      - traefik.http.routers.n8n.middlewares=tailnet-only@file
      - traefik.http.services.n8n.loadbalancer.server.port=5678

networks:
  gateway:
    external: true
    name: gateway
YAML

cd /opt/n8n && sudo docker compose up -d
[+] Running 1/1
 ✔ Container n8n  Started                                                                                          0.6s
glyph@nxcore:/opt/n8n$ sudo tailscale cert files.av
sudo tailscale cert portainer.av
sudo tailscale cert n8n.av
500 Internal Server Error: invalid domain "files.av"; must be one of ["nxcore.tail79107c.ts.net"]
500 Internal Server Error: invalid domain "portainer.av"; must be one of ["nxcore.tail79107c.ts.net"]
500 Internal Server Error: invalid domain "n8n.av"; must be one of ["nxcore.tail79107c.ts.net"]
glyph@nxcore:/opt/n8n$     volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./dynamic:/etc/traefik/dynamic
      - /var/lib/tailscale:/var/lib/tailscale:ro   # <-- for certs
    command:
      - --entrypoints.web.address=:8080
      - --entrypoints.websecure.address=:443       # <-- new
      - --providers.docker=true
      - --providers.file.directory=/etc/traefik/dynamic
volumes:: command not found
-: command not found
-: command not found
-: command not found
Command 'command:' not found, did you mean:
  command 'commando' from snap commando (1.9.3)
See 'snap info <snapname>' for additional versions.
-: command not found
-: command not found
-: command not found
-: command not found
glyph@nxcore:/opt/n8n$ sudo docker ps --format 'table {{.Names}}\t{{.Image}}\t{{.Ports}}'
NAMES           IMAGE                                     PORTS
n8n             docker.n8n.io/n8nio/n8n:latest
filebrowser     filebrowser/filebrowser:latest            80/tcp
traefik         traefik:v3.0                              80/tcp, 0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp
node_exporter   quay.io/prometheus/node-exporter:latest
watchtower      containrrr/watchtower:latest              8080/tcp
aerocaller      node:18-alpine                            0.0.0.0:4443->4443/tcp, [::]:4443->4443/tcp
coturn          coturn/coturn:latest
glyph@nxcore:/opt/n8n$ sudo ss -ltnp | grep ':8080'
LISTEN 0      4096                                  0.0.0.0:8080       0.0.0.0:*    users:(("docker-proxy",pid=1535252,fd=7))
LISTEN 0      4096                                     [::]:8080          [::]:*    users:(("docker-proxy",pid=1535259,fd=7))
glyph@nxcore:/opt/n8n$ sudo docker inspect filebrowser --format '{{json .NetworkSettings.Networks}}'
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["filebrowser","filebrowser"],"MacAddress":"ba:87:98:1d:37:73","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"9733a489acff5c3246683dd6811fe2ca644948a5277c35c2a71fedd085b900ff","Gateway":"172.21.0.1","IPAddress":"172.21.0.3","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["filebrowser","5db78a4eab13"]}}
glyph@nxcore:/opt/n8n$ sudo docker inspect n8n --format '{{json .NetworkSettings.Networks}}'
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["n8n","n8n"],"MacAddress":"","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"","Gateway":"","IPAddress":"","IPPrefixLen":0,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["n8n","9e764d4da2e8"]}}
glyph@nxcore:/opt/n8n$ cd /opt/portainer
glyph@nxcore:/opt/portainer$ sudo docker compose up -d
[+] Running 1/1
 ✘ Container portainer  Error response from daemon: Conflict. The container name "/portai...                       0.0s
Error response from daemon: Conflict. The container name "/portainer" is already in use by container "eb50086b638241c6782efd306ea1352e39afb43c4414d2bc4675113292fa8153". You have to remove (or rename) that container to be able to reuse that name.
glyph@nxcore:/opt/portainer$ sudo docker inspect portainer --format '{{json .Mounts}}' | jq
[
  {
    "Type": "bind",
    "Source": "/var/run/docker.sock",
    "Destination": "/var/run/docker.sock",
    "Mode": "",
    "RW": true,
    "Propagation": "rprivate"
  },
  {
    "Type": "volume",
    "Name": "portainer_data",
    "Source": "/var/lib/docker/volumes/portainer_data/_data",
    "Destination": "/data",
    "Driver": "local",
    "Mode": "z",
    "RW": true,
    "Propagation": ""
  }
]
glyph@nxcore:/opt/portainer$ sudo docker stop portainer
portainer
glyph@nxcore:/opt/portainer$ sudo docker compose up -d
[+] Running 1/1
 ✘ Container portainer  Error response from daemon: Conflict. The container name "/portai...                       0.0s
Error response from daemon: Conflict. The container name "/portainer" is already in use by container "eb50086b638241c6782efd306ea1352e39afb43c4414d2bc4675113292fa8153". You have to remove (or rename) that container to be able to reuse that name.
glyph@nxcore:/opt/portainer$ curl -I http://n8n.av:8080/
curl: (6) Could not resolve host: n8n.av
glyph@nxcore:/opt/portainer$ # Traefik listening on :8080
sudo ss -ltnp | grep ':8080'

# FileBrowser router labels
sudo docker inspect filebrowser --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

# Portainer (after migration)
sudo docker ps --filter name=portainer --format 'table {{.Names}}\t{{.Ports}}'
sudo docker inspect portainer --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

# n8n labels
sudo docker inspect n8n --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'
# Traefik listening on :8080
sudo ss -ltnp | grep ':8080'

# FileBrowser router labels
sudo docker inspect filebrowser --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

# Portainer (after migration)
sudo docker ps --filter name=portainer --format 'table {{.Names}}\t{{.Ports}}'
sudo docker inspect portainer --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'

# n8n labels
sudo docker inspect n8n --format '{{range $k,$v := .Config.Labels}}{{println $k "=" $v}}{{end}}'
LISTEN 0      4096                                  0.0.0.0:8080       0.0.0.0:*    users:(("docker-proxy",pid=1535252,fd=7))
LISTEN 0      4096                                     [::]:8080          [::]:*    users:(("docker-proxy",pid=1535259,fd=7))
com.docker.compose.config-hash = 949d545b6bc7eaefee01639dd330bb5eb7300b2a864868e21573e1f65e6f58dc
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:3d55f9a1b31ccd9e4ad9d3a262e754450d75103c226906fce3100d9198b70a70
com.docker.compose.oneoff = False
com.docker.compose.project = filebrowser
com.docker.compose.project.config_files = /opt/filebrowser/docker-compose.yml
com.docker.compose.project.working_dir = /opt/filebrowser
com.docker.compose.replace = filebrowser
com.docker.compose.service = filebrowser
com.docker.compose.version = 2.40.0
org.opencontainers.image.created = 2025-09-25T15:23:29Z
org.opencontainers.image.name = filebrowser
org.opencontainers.image.revision = 878cdfbc52bdb4c4385f24904a87927f852cb907
org.opencontainers.image.source = https://github.com/filebrowser/filebrowser
org.opencontainers.image.version = 2.44.0
traefik.enable = true
traefik.http.routers.filebrowser.entrypoints = web
traefik.http.routers.filebrowser.middlewares = tailnet-only@file
traefik.http.routers.filebrowser.rule = Host(`files.av`) || Host(`files.aerovista.local`)
traefik.http.services.filebrowser.loadbalancer.server.port = 80

NAMES     PORTS
com.docker.desktop.extension.api.version = >= 0.2.2
com.docker.desktop.extension.icon = https://portainer-io-assets.sfo2.cdn.digitaloceanspaces.com/logos/portainer.png
com.docker.extension.additional-urls = [{"title":"Website","url":"https://www.portainer.io?utm_campaign=DockerCon&utm_source=DockerDesktop"},{"title":"Documentation","url":"https://docs.portainer.io"},{"title":"Support","url":"https://join.slack.com/t/portainer/shared_invite/zt-txh3ljab-52QHTyjCqbe5RibC2lcjKA"}]
com.docker.extension.detailed-description = <p data-renderer-start-pos="226">Portainer&rsquo;s Docker Desktop extension gives you access to all of Portainer&rsquo;s rich management functionality within your docker desktop experience.</p><h2 data-renderer-start-pos="374">With Portainer you can:</h2><ul><li>See all your running containers</li><li>Easily view all of your container logs</li><li>Console into containers</li><li>Easily deploy your code into containers using a simple form</li><li>Turn your YAML into custom templates for easy reuse</li></ul><h2 data-renderer-start-pos="660">About Portainer&nbsp;</h2><p data-renderer-start-pos="680">Portainer is the worlds&rsquo; most popular universal container management platform with more than 650,000 active monthly users. Portainer can be used to manage Docker Standalone, Kubernetes and Docker Swarm environments through a single common interface. It includes a simple GitOps automation engine and a Kube API.&nbsp;</p><p data-renderer-start-pos="1006">Portainer Business Edition is our fully supported commercial grade product for business-wide use. It includes all the functionality that businesses need to manage containers at scale. Visit <a class="sc-jKJlTe dPfAtb" href="http://portainer.io/" title="http://Portainer.io" data-renderer-mark="true">Portainer.io</a> to learn more about Portainer Business and <a class="sc-jKJlTe dPfAtb" href="http://portainer.io/take-3?utm_campaign=DockerCon&amp;utm_source=Docker%20Desktop" title="http://portainer.io/take-3?utm_campaign=DockerCon&amp;utm_source=Docker%20Desktop" data-renderer-mark="true">get 3 free nodes.</a></p>
com.docker.extension.publisher-url = https://www.portainer.io
com.docker.extension.screenshots = [{"alt": "screenshot one", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-1.png"},{"alt": "screenshot two", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-2.png"},{"alt": "screenshot three", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-3.png"},{"alt": "screenshot four", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-4.png"},{"alt": "screenshot five", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-5.png"},{"alt": "screenshot six", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-6.png"},{"alt": "screenshot seven", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-7.png"},{"alt": "screenshot eight", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-8.png"},{"alt": "screenshot nine", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-9.png"}]
io.portainer.server = true
org.opencontainers.image.description = Docker container management made simple, with the world’s most popular GUI-based container management platform.
org.opencontainers.image.title = Portainer
org.opencontainers.image.vendor = Portainer.io

com.docker.compose.config-hash = 1472607da8b524456f024a7073b59e9bd890292b6aa60c49096a50f22fd02759
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:7da8522a831870a2816e3e1cba50b2487b88bcaf31862d78010708f5b18afb71
com.docker.compose.oneoff = False
com.docker.compose.project = n8n
com.docker.compose.project.config_files = /opt/n8n/docker-compose.yml
com.docker.compose.project.working_dir = /opt/n8n
com.docker.compose.replace = n8n
com.docker.compose.service = n8n
com.docker.compose.version = 2.40.0
org.opencontainers.image.description = Workflow Automation Tool
org.opencontainers.image.source = https://github.com/n8n-io/n8n
org.opencontainers.image.title = n8n
org.opencontainers.image.url = https://n8n.io
org.opencontainers.image.version = 1.114.4
traefik.enable = true
traefik.http.routers.n8n.entrypoints = web
traefik.http.routers.n8n.middlewares = tailnet-only@file
traefik.http.routers.n8n.rule = Host(`n8n.av`) || Host(`n8n.aerovista.local`)
traefik.http.services.n8n.loadbalancer.server.port = 5678

LISTEN 0      4096                                  0.0.0.0:8080       0.0.0.0:*    users:(("docker-proxy",pid=1535252,fd=7))
LISTEN 0      4096                                     [::]:8080          [::]:*    users:(("docker-proxy",pid=1535259,fd=7))
com.docker.compose.config-hash = 949d545b6bc7eaefee01639dd330bb5eb7300b2a864868e21573e1f65e6f58dc
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:3d55f9a1b31ccd9e4ad9d3a262e754450d75103c226906fce3100d9198b70a70
com.docker.compose.oneoff = False
com.docker.compose.project = filebrowser
com.docker.compose.project.config_files = /opt/filebrowser/docker-compose.yml
com.docker.compose.project.working_dir = /opt/filebrowser
com.docker.compose.replace = filebrowser
com.docker.compose.service = filebrowser
com.docker.compose.version = 2.40.0
org.opencontainers.image.created = 2025-09-25T15:23:29Z
org.opencontainers.image.name = filebrowser
org.opencontainers.image.revision = 878cdfbc52bdb4c4385f24904a87927f852cb907
org.opencontainers.image.source = https://github.com/filebrowser/filebrowser
org.opencontainers.image.version = 2.44.0
traefik.enable = true
traefik.http.routers.filebrowser.entrypoints = web
traefik.http.routers.filebrowser.middlewares = tailnet-only@file
traefik.http.routers.filebrowser.rule = Host(`files.av`) || Host(`files.aerovista.local`)
traefik.http.services.filebrowser.loadbalancer.server.port = 80

NAMES     PORTS
com.docker.desktop.extension.api.version = >= 0.2.2
com.docker.desktop.extension.icon = https://portainer-io-assets.sfo2.cdn.digitaloceanspaces.com/logos/portainer.png
com.docker.extension.additional-urls = [{"title":"Website","url":"https://www.portainer.io?utm_campaign=DockerCon&utm_source=DockerDesktop"},{"title":"Documentation","url":"https://docs.portainer.io"},{"title":"Support","url":"https://join.slack.com/t/portainer/shared_invite/zt-txh3ljab-52QHTyjCqbe5RibC2lcjKA"}]
com.docker.extension.detailed-description = <p data-renderer-start-pos="226">Portainer&rsquo;s Docker Desktop extension gives you access to all of Portainer&rsquo;s rich management functionality within your docker desktop experience.</p><h2 data-renderer-start-pos="374">With Portainer you can:</h2><ul><li>See all your running containers</li><li>Easily view all of your container logs</li><li>Console into containers</li><li>Easily deploy your code into containers using a simple form</li><li>Turn your YAML into custom templates for easy reuse</li></ul><h2 data-renderer-start-pos="660">About Portainer&nbsp;</h2><p data-renderer-start-pos="680">Portainer is the worlds&rsquo; most popular universal container management platform with more than 650,000 active monthly users. Portainer can be used to manage Docker Standalone, Kubernetes and Docker Swarm environments through a single common interface. It includes a simple GitOps automation engine and a Kube API.&nbsp;</p><p data-renderer-start-pos="1006">Portainer Business Edition is our fully supported commercial grade product for business-wide use. It includes all the functionality that businesses need to manage containers at scale. Visit <a class="sc-jKJlTe dPfAtb" href="http://portainer.io/" title="http://Portainer.io" data-renderer-mark="true">Portainer.io</a> to learn more about Portainer Business and <a class="sc-jKJlTe dPfAtb" href="http://portainer.io/take-3?utm_campaign=DockerCon&amp;utm_source=Docker%20Desktop" title="http://portainer.io/take-3?utm_campaign=DockerCon&amp;utm_source=Docker%20Desktop" data-renderer-mark="true">get 3 free nodes.</a></p>
com.docker.extension.publisher-url = https://www.portainer.io
com.docker.extension.screenshots = [{"alt": "screenshot one", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-1.png"},{"alt": "screenshot two", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-2.png"},{"alt": "screenshot three", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-3.png"},{"alt": "screenshot four", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-4.png"},{"alt": "screenshot five", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-5.png"},{"alt": "screenshot six", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-6.png"},{"alt": "screenshot seven", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-7.png"},{"alt": "screenshot eight", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-8.png"},{"alt": "screenshot nine", "url": "https://portainer-io-assets.sfo2.digitaloceanspaces.com/screenshots/docker-extension-9.png"}]
io.portainer.server = true
org.opencontainers.image.description = Docker container management made simple, with the world’s most popular GUI-based container management platform.
org.opencontainers.image.title = Portainer
org.opencontainers.image.vendor = Portainer.io

com.docker.compose.config-hash = 1472607da8b524456f024a7073b59e9bd890292b6aa60c49096a50f22fd02759
com.docker.compose.container-number = 1
com.docker.compose.depends_on =
com.docker.compose.image = sha256:7da8522a831870a2816e3e1cba50b2487b88bcaf31862d78010708f5b18afb71
com.docker.compose.oneoff = False
com.docker.compose.project = n8n
com.docker.compose.project.config_files = /opt/n8n/docker-compose.yml
com.docker.compose.project.working_dir = /opt/n8n
com.docker.compose.replace = n8n
com.docker.compose.service = n8n
com.docker.compose.version = 2.40.0
org.opencontainers.image.description = Workflow Automation Tool
org.opencontainers.image.source = https://github.com/n8n-io/n8n
org.opencontainers.image.title = n8n
org.opencontainers.image.url = https://n8n.io
org.opencontainers.image.version = 1.114.4
traefik.enable = true
traefik.http.routers.n8n.entrypoints = web
traefik.http.routers.n8n.middlewares = tailnet-only@file
traefik.http.routers.n8n.rule = Host(`n8n.av`) || Host(`n8n.aerovista.local`)
traefik.http.services.n8n.loadbalancer.server.port = 5678

glyph@nxcore:/opt/portainer$ sudo docker rm portainer
portainer
glyph@nxcore:/opt/portainer$ cd /opt/portainer
sudo docker compose up -d
[+] Running 1/1
 ✔ Container portainer  Started                                                                                    0.2s
glyph@nxcore:/opt/portainer$ sudo docker ps --filter name=portainer --format 'table {{.Names}}\t{{.Ports}}'
sudo docker logs --since 2m traefik | egrep -i 'portainer|router|rule|error' || true
NAMES       PORTS
portainer   8000/tcp, 9000/tcp, 9443/tcp
2025-10-13T11:01:41Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T11:02:44Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T11:03:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:/opt/portainer$ sudo docker ps --filter name=portainer --format 'table {{.Names}}\t{{.Ports}}'
NAMES       PORTS
portainer   8000/tcp, 9000/tcp, 9443/tcp
glyph@nxcore:/opt/portainer$ sudo docker logs --since 2m traefik | egrep -i 'portainer|router|rule|error' || true
2025-10-13T11:02:44Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T11:03:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:/opt/portainer$ docker ps --filter name=portainer --format '{{.Image}} -> {{.Ports}}'
portainer/portainer-ce:latest -> 8000/tcp, 9000/tcp, 9443/tcp
glyph@nxcore:/opt/portainer$ docker stop portainer || true
portainer
glyph@nxcore:/opt/portainer$ docker rm portainer || true
portainer
glyph@nxcore:/opt/portainer$ version: "3.8"
services:
  portainer:
    image: portainer/portainer-ee:lts
    command: -H unix:///var/run/docker.sock
    restart: always
    networks: [traefik]                 # <- the same external Traefik network you already use
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    labels:
      - traefik.enable=true
      - traefik.http.routers.portainer.rule=Host(`portainer.aerovista.local`)
      - traefik.http.routers.portainer.entrypoints=websecure
      - traefik.http.routers.portainer.tls.certresolver=leresolver
      - traefik.http.services.portainer.loadbalancer.server.port=9000
      # Optional: expose Edge UI later if you plan to use Edge Agents
      # - traefik.http.routers.portainer-edge.rule=Host(`edge.aerovista.local`)
      # - traefik.http.routers.portainer-edge.entrypoints=websecure
      # - traefik.http.routers.portainer-edge.tls.certresolver=leresolver
      # - traefik.http.services.portainer-edge.loadbalancer.server.port=8000

volumes:
  portainer_data:

networks:
  traefik:
    external: true
version:: command not found
services:: command not found
portainer:: command not found
Command 'image:' not found, did you mean:
  command 'imagej' from deb imagej (1.54g-1)
  command 'imagen' from deb hevea (2.36-2)
Try: sudo apt install <deb name>
Command 'command:' not found, did you mean:
  command 'commando' from snap commando (1.9.3)
See 'snap info <snapname>' for additional versions.
Command 'restart:' not found, did you mean:
  command 'restartd' from deb restartd (0.2.3-1.1)
Try: sudo apt install <deb name>
networks:: command not found
volumes:: command not found
-: command not found
-: command not found
labels:: command not found
-: command not found
-bash: syntax error near unexpected token `('
-: command not found
-: command not found
-: command not found
volumes:: command not found
portainer_data:: command not found
networks:: command not found
traefik:: command not found
external:: command not found
glyph@nxcore:/opt/portainer$ docker stop portainer || true
docker rm portainer || true
Error response from daemon: No such container: portainer
Error response from daemon: No such container: portainer
glyph@nxcore:/opt/portainer$ docker stop portainer || true
Error response from daemon: No such container: portainer
glyph@nxcore:/opt/portainer$ cd..
cd..: command not found
glyph@nxcore:/opt/portainer$ cd..
cd..: command not found
glyph@nxcore:/opt/portainer$ cd..
cd..: command not found
glyph@nxcore:/opt/portainer$ cd ..
glyph@nxcore:/opt$ cd ..
glyph@nxcore:/$ l
bin@                cdrom/  home/   lib.usr-is-merged/  mnt/   root/  sbin.usr-is-merged/  swap.img  usr/
bin.usr-is-merged/  dev/    lib@    lost+found/         opt/   run/   snap/                sys/      var/
boot/               etc/    lib64@  media/              proc/  sbin@  srv/                 tmp/
glyph@nxcore:/$ l
bin@                cdrom/  home/   lib.usr-is-merged/  mnt/   root/  sbin.usr-is-merged/  swap.img  usr/
bin.usr-is-merged/  dev/    lib@    lost+found/         opt/   run/   snap/                sys/      var/
boot/               etc/    lib64@  media/              proc/  sbin@  srv/                 tmp/
glyph@nxcore:/$ ls
bin                cdrom  home   lib.usr-is-merged  mnt   root  sbin.usr-is-merged  swap.img  usr
bin.usr-is-merged  dev    lib    lost+found         opt   run   snap                sys       var
boot               etc    lib64  media              proc  sbin  srv                 tmp
glyph@nxcore:/$ cd D:\NeXuS\NXCore-Control
-bash: cd: D:NeXuSNXCore-Control: No such file or directory
glyph@nxcore:/$ tailscale ip
100.115.9.61
fd7a:115c:a1e0::9901:93e
glyph@nxcore:/$ home
Command 'home' not found, did you mean:
  command 'hime' from deb hime (0.9.11+dfsg-4)
  command 'hose' from deb netpipes (4.2-8build1)
Try: sudo apt install <deb name>
glyph@nxcore:/$ cd home
glyph@nxcore:/home$ ls
glyph
glyph@nxcore:/home$ cd glyph
glyph@nxcore:~$ ls
media-backup.service  media-backup.sh  media-backup.timer  snap
glyph@nxcore:~$ cd snap
glyph@nxcore:~/snap$ ls
powershell
glyph@nxcore:~/snap$ cd
glyph@nxcore:~$ ls
media-backup.service  media-backup.sh  media-backup.timer  snap
glyph@nxcore:~$ cd\
> ls
Command 'cdls' not found, did you mean:
  command 'ccls' from snap ccls (0.20241108)
  command 'ccls' from deb ccls (0.20230717-1build2)
  command 'ddls' from deb python3-deepdish (0.3.7-2)
See 'snap info <snapname>' for additional versions.
glyph@nxcore:~$ sudo docker ps --filter name=portainer --format 'table {{.Names}}\t{{.Ports}}'
[sudo] password for glyph:
NAMES     PORTS
glyph@nxcore:~$ ssh glyph@100.115.9.61 'mkdir -p ~/NXCore-Control/docker'
glyph@100.115.9.61's password:
glyph@nxcore:~$ scp "D:\NeXuS\NXCore-Control\docker\compose-portainer.ee.fixed.yml" `
>     glyph@100.115.9.61:~/NXCore-Control/docker/compose-portainer.ee.yml
> ssh glyph@100.115.9.61 'sudo mkdir -p /opt/portainer && sudo cp ~/NXCore-Control/docker/compose-portainer.ee.yml /opt/portainer/ && sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d'
>
>
> ^C
glyph@nxcore:~$ scp "D:\NeXuS\NXCore-Control\docker\compose-portainer.ee.fixed.yml" `
    glyph@100.115.9.61:~/NXCore-Control/docker/compose-portainer.ee.yml
>
> ^C
glyph@nxcore:~$ # from your Windows machine (100.76.201.75)
# 1) create a staging folder on the server (in glyph's home)
ssh glyph@100.115.9.61 'mkdir -p ~/NXCore-Control/docker'

# 2) copy the compose file up (rename to a clean name)
scp "D:\NeXuS\NXCore-Control\docker\compose-portainer.ee.fixed.yml" `
    glyph@100.115.9.61:~/NXCore-Control/docker/compose-portainer.ee.yml

# 3) place it under /opt/portainer and deploy (needs sudo on the server)
ssh glyph@100.115.9.61 'sudo mkdir -p /opt/portainer && sudo cp ~/NXCore-Control/docker/compose-portainer.ee.yml /opt/portainer/ && sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d'
glyph@100.115.9.61's password:
>
> ^C
glyph@nxcore:~$ scp "D:\NeXuS\NXCore-Control\docker\compose-portainer.ee.fixed.yml" `
    glyph@100.115.9.61:~/NXCore-Control/docker/compose-portainer.ee.yml

# 3) place it under /opt/portainer and deploy (needs sudo on the server)
ssh glyph@100.115.9.61 'sudo mkdir -p /opt/portainer && sudo cp ~/NXCore-Control/docker/compose-portainer.ee.yml /opt/portainer/ && sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
>
>
>
>
>
>
>
> ^C
glyph@nxcore:~$ sudo mkdir -p /opt/portainer && sudo cp ~/NXCore-Control/docker/compose-portainer.ee.yml /opt/portainer/ && sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[sudo] password for glyph:
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 9/9
 ✔ portainer Pulled                                                                                                8.3s
   ✔ dd71b00e32eb Already exists                                                                                   0.0s
   ✔ 3ecc252cea9e Already exists                                                                                   0.0s
   ✔ c551c6af3241 Already exists                                                                                   0.0s
   ✔ 364b464969a7 Pull complete                                                                                    0.4s
   ✔ f13582e48534 Pull complete                                                                                    0.4s
   ✔ c47d72f93f84 Pull complete                                                                                    6.0s
   ✔ 58a97d6e01de Pull complete                                                                                    6.9s
   ✔ 4f4fb700ef54 Pull complete                                                                                    7.0s
network traefik declared as external, but could not be found
glyph@nxcore:~$ sudo docker network create traefik
[sudo] password for glyph:
6e4f9d3aa3788a430582215ee5105d5ad6fcbf49372a75dfedf468b5d399b9e0
glyph@nxcore:~$ sudo docker network connect traefik traefik
glyph@nxcore:~$ docker inspect -f '{{json .NetworkSettings.Networks}}' traefik
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["traefik","traefik"],"MacAddress":"2a:47:ed:ab:88:58","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"4ba78dbc90d8a34dc41c91c254417d7d848c5c14a6e632dc496cbdc4436c2e36","Gateway":"172.21.0.1","IPAddress":"172.21.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["traefik","486fef466062"]},"traefik":{"IPAMConfig":{},"Links":null,"Aliases":[],"MacAddress":"8a:75:fa:45:56:be","DriverOpts":{},"GwPriority":0,"NetworkID":"6e4f9d3aa3788a430582215ee5105d5ad6fcbf49372a75dfedf468b5d399b9e0","EndpointID":"cef0ebddecfd85c33edc48ad539742806429c6ee9db354d94fee83c9ee8feb62","Gateway":"172.22.0.1","IPAddress":"172.22.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["traefik","486fef466062"]}}
glyph@nxcore:~$ docker inspect -f '{{json .NetworkSettings.Networks}}' portainer

Error: No such object: portainer
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 2/2
 ✔ Volume portainer_portainer_data  Created                                                                        0.0s
 ✔ Container portainer-portainer-1  Started                                                                        0.2s
glyph@nxcore:~$ docker ps --filter name=portainer
docker inspect -f '{{json .NetworkSettings.Networks}}' portainer
# expect to see a "traefik" entry similar to what Traefik shows
CONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS                          NAMES
ed06bdbe43fe   portainer/portainer-ee:lts   "/portainer -H unix:…"   34 seconds ago   Up 34 seconds   8000/tcp, 9000/tcp, 9443/tcp   portainer-portainer-1

Error: No such object: portainer
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'portainer|router|rule|error' || true
2025-10-13T15:34:58Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:35:16Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:35:16Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:35:16Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:35:16Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:35:16Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:35:16Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:35:58Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:35:58Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:35:58Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:35:58Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:35:58Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:36:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:36:01Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:36:01Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:36:01Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:36:01Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:36:01Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
glyph@nxcore:~$ nano /opt/portainer/compose-portainer.ee.yml
glyph@nxcore:~$ nano /opt/portainer/compose-portainer.ee.yml
glyph@nxcore:~$ docker inspect traefik --format '{{json .Config.Cmd}}' | jq -r '.[]'
--api=false
--providers.docker=true
--providers.docker.exposedbydefault=false
--providers.file.directory=/etc/traefik/dynamic
--entrypoints.web.address=:8080
glyph@nxcore:~$ docker logs --since 10m traefik | egrep -i 'entrypoint|websecure|web |acme|resolver|certificate|letsencrypt' || true
2025-10-13T15:38:05Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:38:06Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:38:06Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:38:06Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:38:06Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:38:06Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:39:06Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:39:06Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:39:06Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:39:06Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:39:06Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:39:08Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:39:08Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:39:08Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:39:08Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:39:08Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:39:08Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:40:09Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:40:09Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:40:09Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:40:09Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:40:09Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:40:11Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:40:11Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:40:11Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:40:11Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:40:11Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:40:11Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:41:11Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:41:11Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:41:11Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:41:11Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:41:11Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:41:13Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:41:14Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:41:14Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:41:14Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:41:14Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:41:14Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:42:13Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:42:13Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:42:13Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:42:13Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:42:13Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:42:16Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:42:16Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:42:16Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:42:16Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:42:16Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:42:16Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:43:16Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:43:16Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:43:16Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:43:16Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:43:16Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:43:18Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:43:18Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:43:18Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:43:18Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:43:18Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:43:18Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:44:19Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:44:19Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:44:19Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:44:19Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:44:19Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:44:21Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:44:21Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:44:21Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:44:21Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:44:21Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:44:21Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:45:21Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:45:21Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:45:21Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:45:21Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:45:21Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:45:23Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:45:24Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:45:24Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:45:24Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:45:24Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:45:24Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:46:24Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:46:24Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:46:24Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:46:24Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:46:24Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:46:26Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:46:26Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:46:26Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:46:26Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:46:26Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:46:26Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:47:26Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:47:26Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:47:26Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:47:26Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:47:26Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T15:47:29Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T15:47:29Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:47:29Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:47:29Z ERR EntryPoint doesn't exist entryPointName=websecure routerName=portainer@docker
2025-10-13T15:47:29Z ERR No valid entryPoint for this router routerName=portainer@docker
2025-10-13T15:47:29Z ERR Router uses a non-existent certificate resolver certificateResolver=leresolver routerName=portainer@docker
glyph@nxcore:~$ docker inspect -f '{{json .NetworkSettings.Networks}}' traefik
{"gateway":{"IPAMConfig":null,"Links":null,"Aliases":["traefik","traefik"],"MacAddress":"2a:47:ed:ab:88:58","DriverOpts":null,"GwPriority":0,"NetworkID":"3a44fc727c1c0b4d318aedf09c395687d9b0cda0aaa445293a8b86ab5255fbbd","EndpointID":"4ba78dbc90d8a34dc41c91c254417d7d848c5c14a6e632dc496cbdc4436c2e36","Gateway":"172.21.0.1","IPAddress":"172.21.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["traefik","486fef466062"]},"traefik":{"IPAMConfig":{},"Links":null,"Aliases":[],"MacAddress":"8a:75:fa:45:56:be","DriverOpts":{},"GwPriority":0,"NetworkID":"6e4f9d3aa3788a430582215ee5105d5ad6fcbf49372a75dfedf468b5d399b9e0","EndpointID":"cef0ebddecfd85c33edc48ad539742806429c6ee9db354d94fee83c9ee8feb62","Gateway":"172.22.0.1","IPAddress":"172.22.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["traefik","486fef466062"]}}
glyph@nxcore:~$ sudo mkdir -p /etc/traefik/tailscale
sudo tailscale cert \
  --cert-file /etc/traefik/tailscale/portainer.crt \
  --key-file  /etc/traefik/tailscale/portainer.key \
  portainer.aerovista.local
[sudo] password for glyph:
500 Internal Server Error: invalid domain "portainer.aerovista.local"; must be one of ["nxcore.tail79107c.ts.net"]
glyph@nxcore:~$ sudo mkdir -p /etc/traefik/tailscale
sudo tailscale cert \
  --cert-file /etc/traefik/tailscale/nxcore.crt \
  --key-file  /etc/traefik/tailscale/nxcore.key \
  nxcore.tail79107c.ts.net
Wrote public cert to /etc/traefik/tailscale/nxcore.crt
Wrote private key to /etc/traefik/tailscale/nxcore.key
glyph@nxcore:~$ sudo tee /etc/traefik/tls.yml >/dev/null <<'YAML'
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key
YAML
glyph@nxcore:~$ sudo tee /etc/traefik/tls.yml >/dev/null <<'YAML'
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key
>
> ^C
glyph@nxcore:~$ --providers.docker=true
--providers.docker.exposedbydefault=false
--providers.file.filename=/etc/traefik/tls.yml
--entrypoints.web.address=:80
--entrypoints.websecure.address=:443
--entrypoints.web.http.redirections.entrypoint.to=websecure
--entrypoints.web.http.redirections.entrypoint.scheme=https
--providers.docker=true: command not found
--providers.docker.exposedbydefault=false: command not found
-bash: --providers.file.filename=/etc/traefik/tls.yml: No such file or directory
--entrypoints.web.address=:80: command not found
--entrypoints.websecure.address=:443: command not found
--entrypoints.web.http.redirections.entrypoint.to=websecure: command not found
--entrypoints.web.http.redirections.entrypoint.scheme=https: command not found
glyph@nxcore:~$ /var/run/docker.sock:/var/run/docker.sock:ro
/etc/traefik/tailscale:/etc/traefik/tailscale:ro
/etc/traefik/tls.yml:/etc/traefik/tls.yml:ro
-bash: /var/run/docker.sock:/var/run/docker.sock:ro: No such file or directory
-bash: /etc/traefik/tailscale:/etc/traefik/tailscale:ro: No such file or directory
-bash: /etc/traefik/tls.yml:/etc/traefik/tls.yml:ro: No such file or directory
glyph@nxcore:~$ sudo sed -n '1,200p' /etc/traefik/tls.yml
[sudo] password for glyph:
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key


glyph@nxcore:~$ sudo docker compose -f /opt/traefik/compose-traefik.yml up -d
WARN[0000] /opt/traefik/compose-traefik.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 5/5
 ✔ traefik Pulled                                                                                                 14.5s
   ✔ 2d35ebdb57d9 Pull complete                                                                                    1.2s
   ✔ c22bd0179750 Pull complete                                                                                    1.3s
   ✔ 6cd4fbf87175 Pull complete                                                                                   13.2s
   ✔ 787b8e1b941c Pull complete                                                                                   13.2s
[+] Running 1/1
 ✔ Container traefik  Started                                                                                      1.2s
glyph@nxcore:~$ docker logs --since 1m traefik | egrep -i 'entrypoint|websecure|tls|certificate' || true
2025-10-13T16:16:02Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:16:02Z ERR Router uses a nonexistent certificate resolver certificateResolver=leresolver routerName=portainer@docker
glyph@nxcore:~$ sudo nano /opt/portainer/compose-portainer.ee.yml
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.4s
glyph@nxcore:~$ sudo tee -a /etc/traefik/tls.yml >/dev/null <<'YAML'

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range (covers your tailnet)
YAML

# reload Traefik
docker restart traefik
traefik
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'portainer|filebrowser|router|error|resolver|middleware' || true
2025-10-13T16:18:44Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=n8n@docker
2025-10-13T16:18:44Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:18:44Z ERR Router uses a nonexistent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T16:18:46Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:18:46Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:18:46Z ERR Router uses a nonexistent certificate resolver certificateResolver=leresolver routerName=portainer@docker
2025-10-13T16:19:06Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:19:06Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:19:07Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:19:09Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:19:42Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:19:49Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ sudo sed -i '/traefik.http.routers.portainer.tls.certresolver/d' /opt/portainer/compose-portainer.ee.yml
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container portainer-portainer-1  Running                                                                        0.0s
glyph@nxcore:~$ sudo tee -a /etc/traefik/tls.yml >/dev/null <<'YAML'

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range (covers your tailnet)
YAML

# reload Traefik
docker restart traefik
traefik
glyph@nxcore:~$ # Traefik should stop complaining about missing resolver/middleware
docker logs --since 2m traefik | egrep -i 'portainer|filebrowser|router|error|resolver|middleware' || true

# Portainer routed over HTTPS on your tailnet host
curl -I https://nxcore.tail79107c.ts.net  # (root rule)
# or curl -I https://nxcore.tail79107c.ts.net/portainer if you used the path-prefix variant
2025-10-13T16:20:51Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:21:54Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:22:34Z ERR Error occurred during watcher callback error="yaml: unmarshal errors:\n  line 13: mapping key \"http\" already defined at line 6" providerName=file
2025-10-13T16:22:34Z ERR Error while building configuration (for the first time) error="yaml: unmarshal errors:\n  line 13: mapping key \"http\" already defined at line 6" providerName=file
2025-10-13T16:22:34Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:22:34Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
curl: (60) SSL certificate problem: self-signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
glyph@nxcore:~$ sudo tee /etc/traefik/tls.yml >/dev/null <<'YAML'
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range
YAML

# reload Traefik so it re-reads tls.yml
docker restart traefik

# confirm the file provider loads cleanly (no yaml/unmarshal errors)
docker logs --since 90s traefik | egrep -i 'file provider|Loaded|entrypoint|websecure|tls|certificate|error' || true
traefik
2025-10-13T16:26:03Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:26:03Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=n8n@docker
2025-10-13T16:26:04Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:26:04Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:27:05Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T16:27:05Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=n8n@docker
2025-10-13T16:27:07Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T16:27:08Z ERR error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 16:32:36 GMT

glyph@nxcore:~$ docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq .
{
  "com.docker.compose.config-hash": "76398706696c004369c45df2f69fe7b498e548bc76fab851dd8dafce4c434c1d",
  "com.docker.compose.container-number": "1",
  "com.docker.compose.depends_on": "",
  "com.docker.compose.image": "sha256:b0bee03b0e79efb133e4a4bd46722b50b0e511acedc783b10c2379915165ce17",
  "com.docker.compose.oneoff": "False",
  "com.docker.compose.project": "portainer",
  "com.docker.compose.project.config_files": "/opt/portainer/compose-portainer.ee.yml",
  "com.docker.compose.project.working_dir": "/opt/portainer",
  "com.docker.compose.replace": "portainer-1",
  "com.docker.compose.service": "portainer",
  "com.docker.compose.version": "2.40.0",
  "io.portainer.server": "true",
  "traefik.enable": "true",
  "traefik.http.routers.portainer.entrypoints": "websecure",
  "traefik.http.routers.portainer.rule": "Host(`portainer.aerovista.local`)",
  "traefik.http.services.portainer.loadbalancer.server.port": "9000"
}
glyph@nxcore:~$ sudo nano /opt/portainer/compose-portainer.ee.yml
[sudo] password for glyph:
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.4s
glyph@nxcore:~$ docker logs --since 90s traefik | egrep -i 'portainer|router|rule|error' || true
2025-10-13T17:20:19Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T17:21:01Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T17:21:01Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 17:21:36 GMT

glyph@nxcore:~$ # On host (already correct, but verify)
sudo sed -n '1,200p' /etc/traefik/tls.yml

# Inside the container (this is the important check)
docker exec traefik sh -lc 'sed -n "1,200p" /etc/traefik/tls.yml'
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range
glyph@nxcore:~$ docker inspect traefik --format '{{json .Config.Cmd}}' | jq -r '.[]' | egrep -i 'providers\.file|tls\.yml'
--providers.file.filename=/etc/traefik/tls.yml
glyph@nxcore:~$ docker restart traefik
docker logs --since 90s traefik | egrep -i 'file provider|Loaded|tls|certificate|error' || true
traefik
2025-10-13T17:23:27Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ docker compose -f /path/to/n8n-compose.yml up -d
open /path/to/n8n-compose.yml: no such file or directory
glyph@nxcore:~$ ls
media-backup.service  media-backup.sh  media-backup.timer  NXCore-Control  snap
glyph@nxcore:~$ cd opt
-bash: cd: opt: No such file or directory
glyph@nxcore:~$ docker compose -f /opt/n8n/compose-n8n.yml up -d
open /opt/n8n/compose-n8n.yml: no such file or directory
glyph@nxcore:~$ docker compose -f /opt/n8n/docker-compose.yml up -d
[+] Running 1/1
 ✔ Container n8n  Started                                                                                          0.0s
glyph@nxcore:~$ sudo nano /opt/n8n/docker-compose.yml
glyph@nxcore:~$ docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq '.["traefik.http.routers.portainer.rule"]'
"Host(`nxcore.tail79107c.ts.net`)"
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'file provider|yaml|unmarshal|tailnet-only|error' || true
2025-10-13T17:33:53Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T17:34:55Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 17:35:15 GMT

glyph@nxcore:~$ # swap the Host() in your compose
sudo sed -i "s/Host(`portainer\.aerovista\.local`)/Host(`nxcore.tail79107c.ts.net`)/" /opt/portainer/compose-portainer.ee.yml

# redeploy Portainer
sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d

# confirm the label is updated on the running container
docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq '.["traefik.http.routers.portainer.rule"]'
portainer.aerovista.local: command not found
nxcore.tail79107c.ts.net: command not found
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container portainer-portainer-1  Running                                                                        0.0s
"Host(`nxcore.tail79107c.ts.net`)"
glyph@nxcore:~$ sudo sed -i "s/Host(`portainer\.aerovista\.local`)/Host(`nxcore.tail79107c.ts.net`)/" /opt/portainer/compose-portainer.ee.yml
portainer.aerovista.local: command not found
nxcore.tail79107c.ts.net: command not found
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
WARN[0000] /opt/portainer/compose-portainer.ee.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container portainer-portainer-1  Running                                                                        0.0s
glyph@nxcore:~$ docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq '.["traefik.http.routers.portainer.rule"]'
"Host(`nxcore.tail79107c.ts.net`)"
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 17:38:12 GMT

glyph@nxcore:~$ sudo sed -i '/^version:/d' /opt/portainer/compose-portainer.ee.yml
glyph@nxcore:~$ sudo nano /opt/n8n/docker-compose.yml
glyph@nxcore:~$ sudo nano /opt/n8n/docker-compose.yml
glyph@nxcore:~$ sudo nano /opt/n8n/docker-compose.yml
glyph@nxcore:~$ docker compose -f /opt/n8n/docker-compose.yml up -d
yaml: line 11: did not find expected '-' indicator
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'portainer|router|error' || true
2025-10-13T17:40:08Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T17:41:11Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 17:42:05 GMT

glyph@nxcore:~$ docker inspect -f '{{json .NetworkSettings.Networks}}' portainer-portainer-1
{"traefik":{"IPAMConfig":null,"Links":null,"Aliases":["portainer-portainer-1","portainer"],"MacAddress":"4a:5c:35:79:a3:30","DriverOpts":null,"GwPriority":0,"NetworkID":"6e4f9d3aa3788a430582215ee5105d5ad6fcbf49372a75dfedf468b5d399b9e0","EndpointID":"c6d54af9a947c08f584672f98daa03af6cbd6cbb004bc30083d8c9ffc4823bbb","Gateway":"172.22.0.1","IPAddress":"172.22.0.3","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DNSNames":["portainer-portainer-1","portainer","762affdc4bab"]}}
glyph@nxcore:~$ docker network connect traefik portainer-portainer-1
Error response from daemon: endpoint with name portainer-portainer-1 already exists in network traefik
glyph@nxcore:~$ sudo bash -lc "awk '1; /traefik.http.services.portainer.loadbalancer.server.port/ {print \"      - traefik.http.routers.portainer.priority=10\"}' /opt/portainer/compose-portainer.ee.yml > /opt/portainer/compose-portainer.ee.tmp && mv /opt/portainer/compose-portainer.ee.tmp /opt/portainer/compose-portainer.ee.yml"
[sudo] password for glyph:
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.4s
glyph@nxcore:~$ docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq -r '.["traefik.http.routers.portainer.rule"], .["traefik.http.routers.portainer.entrypoints"]'
Host(`nxcore.tail79107c.ts.net`)
websecure
glyph@nxcore:~$ docker restart traefik
traefik
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'docker provider|portainer|router|error' || true
2025-10-13T18:04:07Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:05:10Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:05:14Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:05:14Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:05:51Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ sudo nano /opt/portainer/compose-portainer.ee.yml
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
yaml: line 3: did not find expected key
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d


glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
yaml: line 3: did not find expected key
glyph@nxcore:~$ sudo tee /opt/portainer/compose-portainer.ee.yml >/dev/null <<'YAML'
services:
  portainer:
    image: portainer/portainer-ee:lts
    command: -H unix:///var/run/docker.sock
    restart: always
    networks:
      - traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    labels:
      - traefik.enable=true
      - traefik.http.routers.portainer.rule=Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`)
      - traefik.http.routers.portainer.entrypoints=websecure
      - traefik.http.services.portainer.loadbalancer.server.port=9000
      - traefik.http.routers.portainer.priority=10

volumes:
  portainer_data:

networks:
  traefik:
    external: true
YAML
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d

# confirm labels on the *running* container
docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq -r '.["traefik.http.routers.portainer.rule"], .["traefik.http.routers.portainer.entrypoints"]'

# check Traefik picked up the router
docker logs --since 2m traefik | egrep -i 'portainer@docker|router|rule|error' || true

# end-to-end test
curl -I https://nxcore.tail79107c.ts.net
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.3s
Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`)
websecure
2025-10-13T18:12:28Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:13:31Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:14:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:14:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 18:14:00 GMT

glyph@nxcore:~$ docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq -r '.["traefik.http.routers.portainer.rule"], .["traefik.http.routers.portainer.entrypoints"]'
Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`)
websecure
glyph@nxcore:~$ sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[+] Running 1/1
 ✔ Container portainer-portainer-1  Running                                                                        0.0s
glyph@nxcore:~$ docker inspect -f '{{json .Config.Labels}}' portainer-portainer-1 | jq -r '.["traefik.http.routers.portainer.rule"], .["traefik.http.routers.portainer.entrypoints"]'
Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`)
websecure
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'portainer@docker|router|rule|error' || true
2025-10-13T18:13:31Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:14:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:14:00Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
2025-10-13T18:14:33Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-9e764d4da2e8e8bd060f1945301769a2df3427cf4d384840efa6b070bc1e7c9b providerName=docker
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 18:15:40 GMT

glyph@nxcore:~$ docker exec -it traefik sh -lc 'apk add --no-cache curl >/dev/null 2>&1 || true; \
  echo "== by service name =="; curl -sI http://portainer:9000 | head -n1; \
  echo "== by container name =="; curl -sI http://portainer-portainer-1:9000 | head -n1'
== by service name ==
HTTP/1.1 200 OK
== by container name ==
HTTP/1.1 200 OK
glyph@nxcore:~$ docker update --label-add traefik.enable=false n8n 2>/dev/null || true
docker stop n8n
n8n
glyph@nxcore:~$ sudo mkdir -p /opt/n8n
glyph@nxcore:~$ sudo tee /opt/n8n/docker-compose.yml >/dev/null <<'YAML'
> services:
  n8n:
    image: docker.n8n.io/n8nio/n8n:latest
    container_name: n8n
    restart: unless-stopped
    environment:
      - N8N_PROTOCOL=https
      - N8N_HOST=nxcore.tail79107c.ts.net
      - N8N_PORT=5678
      - WEBHOOK_URL=https://nxcore.tail79107c.ts.net/n8n/
    volumes:
      - ./data:/home/node/.n8n
    networks:
      - traefik
    labels:
      - traefik.enable=true
      - traefik.http.routers.n8n.rule=Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/n8n`)
      - traefik.http.routers.n8n.entrypoints=websecure
      - traefik.http.services.n8n.loadbalancer.server.port=5678
      - traefik.http.middlewares.n8n-strip.stripprefix.prefixes=/n8n
      - traefik.http.routers.n8n.middlewares=n8n-strip@docker

networks:
  traefik:
    external: true
YAML

docker compose -f /opt/n8n/docker-compose.yml up -d
docker network connect traefik n8n 2>/dev/null || true
[+] Running 1/1
 ✔ Container n8n  Started                                                                                          0.3s
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'portainer|n8n|router|error' || true
2025-10-13T18:17:12Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:17:14Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:17:17Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:17:20Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:17:24Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:17:28Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:17:34Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
glyph@nxcore:~$ docker exec traefik sh -lc 'sed -n "1,200p" /etc/traefik/tls.yml'
tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range
glyph@nxcore:~$ # overwrite with a known-good compose (keeps your volume)
sudo tee /opt/portainer/compose-portainer.ee.yml >/dev/null <<'YAML'
services:
  portainer:
    image: portainer/portainer-ee:lts
    command: -H unix:///var/run/docker.sock
    restart: always
    networks: [traefik]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik
      - traefik.http.routers.portainer.rule=Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`)
      - traefik.http.routers.portainer.entrypoints=websecure
      - traefik.http.routers.portainer.tls=true
      - traefik.http.services.portainer.loadbalancer.server.port=9000
      - traefik.http.routers.portainer.priority=10
volumes:
  portainer_data:
networks:
  traefik:
    external: true
YAML

sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.3s
glyph@nxcore:~$ docker logs --since 2m traefik | egrep -i 'portainer@docker|router|rule|error' || true
curl -I https://nxcore.tail79107c.ts.net
2025-10-13T18:20:23Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:21:25Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:21:39Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T18:21:39Z ERR error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
HTTP/2 200
accept-ranges: bytes
cache-control: max-age=31536000
content-security-policy: script-src 'self' cdn.matomo.cloud js.hsforms.net https://www.google.com/recaptcha/, https://www.gstatic.com/recaptcha/; object-src 'none'; frame-ancestors 'none'; frame-src https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/
content-type: text/html; charset=utf-8
date: Mon, 13 Oct 2025 18:21:50 GMT
last-modified: Thu, 25 Sep 2025 03:16:34 GMT
permissions-policy: accelerometer=(),ambient-light-sensor=(),attribution-reporting=(),autoplay=(),battery=(),browsing-topics=(),camera=(),captured-surface-control=(),ch-device-memory=(),ch-downlink=(),ch-dpr=(),ch-ect=(),ch-prefers-color-scheme=(),ch-prefers-reduced-motion=(),ch-prefers-reduced-transparency=(),ch-rtt=(),ch-save-data=(),ch-ua=(),ch-ua-arch=(),ch-ua-bitness=(),ch-ua-form-factors=(),ch-ua-full-version=(),ch-ua-full-version-list=(),ch-ua-mobile=(),ch-ua-model=(),ch-ua-platform=(),ch-ua-platform-version=(),ch-ua-wow64=(),ch-viewport-height=(),ch-viewport-width=(),ch-width=(),compute-pressure=(),conversion-measurement=(),cross-origin-isolated=(),deferred-fetch=(),deferred-fetch-minimal=(),display-capture=(),document-domain=(),encrypted-media=(),execution-while-not-rendered=(),execution-while-out-of-viewport=(),focus-without-user-activation=(),fullscreen=(),gamepad=(),geolocation=(),gyroscope=(),hid=(),identity-credentials-get=(),idle-detection=(),interest-cohort=(),join-ad-interest-group=(),keyboard-map=(),language-detector=(),local-fonts=(),magnetometer=(),microphone=(),midi=(),navigation-override=(),otp-credentials=(),payment=(),picture-in-picture=(),private-aggregation=(),private-state-token-issuance=(),private-state-token-redemption=(),publickey-credentials-create=(),publickey-credentials-get=(),rewriter=(),run-ad-auction=(),screen-wake-lock=(),serial=(),shared-storage=(),shared-storage-select-url=(),speaker-selection=(),storage-access=(),summarizer=(),sync-script=(),sync-xhr=(),translator=(),trust-token-redemption=(),unload=(),usb=(),vertical-scroll=(),web-share=(),window-management=(),window-placement=(),writer=(),xr-spatial-tracking=()
vary: Accept-Encoding
x-content-type-options: nosniff
x-csrf-token:
content-length: 13505

glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net/portainer
HTTP/2 404
content-security-policy: script-src 'self' cdn.matomo.cloud js.hsforms.net https://www.google.com/recaptcha/, https://www.gstatic.com/recaptcha/; object-src 'none'; frame-ancestors 'none'; frame-src https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/
content-type: text/plain; charset=utf-8
date: Mon, 13 Oct 2025 18:23:45 GMT
vary: Accept-Encoding
x-content-type-options: nosniff
content-length: 19

glyph@nxcore:~$ # add flag to traefik compose command:
#   - --log.level=DEBUG
sudo sed -i 's/^\(\s*- --providers.file.filename=.*\)$/\1\n      - --log.level=DEBUG/' /opt/traefik/compose-traefik.yml
sudo docker compose -f /opt/traefik/compose-traefik.yml up -d

docker logs --since 1m traefik | egrep -i 'adding route|rule|router|portainer' || true
WARN[0000] /opt/traefik/compose-traefik.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container traefik  Started                                                                                      1.0s
glyph@nxcore:~$ sudo nano /opt/traefik/compose-traefik.yml
glyph@nxcore:~$ sudo docker compose -f /opt/traefik/compose-traefik.yml up -d

# List all routers (name + rule + entrypoint + service)
docker exec traefik sh -lc '
  apk add --no-cache curl jq >/dev/null 2>&1 || true
  curl -s http://127.0.0.1:8080/api/http/routers \
  | jq -r ".[] | \"\nname: \(.name)\nrule: \(.rule)\nentryPoints: \(.entryPoints)\nservice: \(.service)\""
'
WARN[0000] /opt/traefik/compose-traefik.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container traefik  Started                                                                                      0.6s

name: api@internal
rule: PathPrefix(`/api`)
entryPoints: ["traefik"]
service: api@internal

name: dashboard@internal
rule: PathPrefix(`/`)
entryPoints: ["traefik"]
service: dashboard@internal

name: filebrowser@docker
rule: Host(`files.av`) || Host(`files.aerovista.local`)
entryPoints: ["web"]
service: filebrowser

name: portainer@docker
rule: Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`)
entryPoints: ["websecure"]
service: portainer

name: web-to-websecure@internal
rule: HostRegexp(`^.+$`)
entryPoints: ["web"]
service: noop@internal
glyph@nxcore:~$ docker exec traefik sh -lc '
  curl -s http://127.0.0.1:8080/api/http/routers \
  | jq -r ".[] | select(.name|test(\"portainer@docker\")) | \"FOUND -> name: \(.name) | rule: \(.rule) | prio: \(.priority) | ep: \(.entryPoints) | service: \(.service)\""
'
FOUND -> name: portainer@docker | rule: Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/`) | prio: 10 | ep: ["websecure"] | service: portainer
glyph@nxcore:~$ # Overwrite Portainer compose with path-prefix, strip, and a response header so we can "see" it
sudo tee /opt/portainer/compose-portainer.ee.yml >/dev/null <<'YAML'
services:
  portainer:
    image: portainer/portainer-ee:lts
    command: -H unix:///var/run/docker.sock
    restart: always
    networks: [traefik]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik

      # ROUTER: host + /portainer
      - traefik.http.routers.portainer.rule=Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/portainer`)
      - traefik.http.routers.portainer.entrypoints=websecure
      - traefik.http.routers.portainer.tls=true
      - traefik.http.routers.portainer.priority=2000

      # SERVICE: Portainer listens on 9000 in-container
      - traefik.http.services.portainer.loadbalancer.server.port=9000

      # STRIP PREFIX
      - traefik.http.middlewares.portainer-strip.stripprefix.prefixes=/portainer
      - traefik.http.routers.portainer.middlewares=portainer-strip@docker,portainer-headers@docker

      # Mark responses so we can verify which router handled it
      - traefik.http.middlewares.portainer-headers.headers.customResponseHeaders.X-Routed-By=portainer@docker
volumes:
  portainer_data:
networks:
  traefik:
    external: true
YAML

sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.4s
glyph@nxcore:~$ docker exec traefik sh -lc '
  curl -s http://127.0.0.1:8080/api/http/routers \
  | jq -r ".[] | select(.name==\"portainer@docker\") | \"name: \(.name) | rule: \(.rule) | prio: \(.priority) | ep: \(.entryPoints) | service: \(.service)\""
'
name: portainer@docker | rule: Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/portainer`) | prio: 2000 | ep: ["websecure"] | service: portainer
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net/portainer
# expect 200/302 and a header:  X-Routed-By: portainer@docker
HTTP/2 200
accept-ranges: bytes
cache-control: max-age=31536000
content-security-policy: script-src 'self' cdn.matomo.cloud js.hsforms.net https://www.google.com/recaptcha/, https://www.gstatic.com/recaptcha/; object-src 'none'; frame-ancestors 'none'; frame-src https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/
content-type: text/html; charset=utf-8
date: Mon, 13 Oct 2025 18:33:42 GMT
last-modified: Thu, 25 Sep 2025 03:16:34 GMT
permissions-policy: accelerometer=(),ambient-light-sensor=(),attribution-reporting=(),autoplay=(),battery=(),browsing-topics=(),camera=(),captured-surface-control=(),ch-device-memory=(),ch-downlink=(),ch-dpr=(),ch-ect=(),ch-prefers-color-scheme=(),ch-prefers-reduced-motion=(),ch-prefers-reduced-transparency=(),ch-rtt=(),ch-save-data=(),ch-ua=(),ch-ua-arch=(),ch-ua-bitness=(),ch-ua-form-factors=(),ch-ua-full-version=(),ch-ua-full-version-list=(),ch-ua-mobile=(),ch-ua-model=(),ch-ua-platform=(),ch-ua-platform-version=(),ch-ua-wow64=(),ch-viewport-height=(),ch-viewport-width=(),ch-width=(),compute-pressure=(),conversion-measurement=(),cross-origin-isolated=(),deferred-fetch=(),deferred-fetch-minimal=(),display-capture=(),document-domain=(),encrypted-media=(),execution-while-not-rendered=(),execution-while-out-of-viewport=(),focus-without-user-activation=(),fullscreen=(),gamepad=(),geolocation=(),gyroscope=(),hid=(),identity-credentials-get=(),idle-detection=(),interest-cohort=(),join-ad-interest-group=(),keyboard-map=(),language-detector=(),local-fonts=(),magnetometer=(),microphone=(),midi=(),navigation-override=(),otp-credentials=(),payment=(),picture-in-picture=(),private-aggregation=(),private-state-token-issuance=(),private-state-token-redemption=(),publickey-credentials-create=(),publickey-credentials-get=(),rewriter=(),run-ad-auction=(),screen-wake-lock=(),serial=(),shared-storage=(),shared-storage-select-url=(),speaker-selection=(),storage-access=(),summarizer=(),sync-script=(),sync-xhr=(),translator=(),trust-token-redemption=(),unload=(),usb=(),vertical-scroll=(),web-share=(),window-management=(),window-placement=(),writer=(),xr-spatial-tracking=()
vary: Accept-Encoding
x-content-type-options: nosniff
x-csrf-token:
x-routed-by: portainer@docker
content-length: 13505

glyph@nxcore:~$ # Add this flag once in Traefik's compose (under command:)
#   - --accesslog=true
# Optional (nicer fields):
#   - --accesslog.fields.defaultmode=keep

sudo docker compose -f /opt/traefik/compose-traefik.yml up -d

# Make two requests and then look at access logs:
curl -I https://nxcore.tail79107c.ts.net
curl -I https://nxcore.tail79107c.ts.net/portainer
docker logs --since 30s traefik | tail -n 100
WARN[0000] /opt/traefik/compose-traefik.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Running 1/1
 ✔ Container traefik  Running                                                                                      0.0s
HTTP/2 404
content-type: text/plain; charset=utf-8
x-content-type-options: nosniff
content-length: 19
date: Mon, 13 Oct 2025 18:33:56 GMT

HTTP/2 200
accept-ranges: bytes
cache-control: max-age=31536000
content-security-policy: script-src 'self' cdn.matomo.cloud js.hsforms.net https://www.google.com/recaptcha/, https://www.gstatic.com/recaptcha/; object-src 'none'; frame-ancestors 'none'; frame-src https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/
content-type: text/html; charset=utf-8
date: Mon, 13 Oct 2025 18:33:56 GMT
last-modified: Thu, 25 Sep 2025 03:16:34 GMT
permissions-policy: accelerometer=(),ambient-light-sensor=(),attribution-reporting=(),autoplay=(),battery=(),browsing-topics=(),camera=(),captured-surface-control=(),ch-device-memory=(),ch-downlink=(),ch-dpr=(),ch-ect=(),ch-prefers-color-scheme=(),ch-prefers-reduced-motion=(),ch-prefers-reduced-transparency=(),ch-rtt=(),ch-save-data=(),ch-ua=(),ch-ua-arch=(),ch-ua-bitness=(),ch-ua-form-factors=(),ch-ua-full-version=(),ch-ua-full-version-list=(),ch-ua-mobile=(),ch-ua-model=(),ch-ua-platform=(),ch-ua-platform-version=(),ch-ua-wow64=(),ch-viewport-height=(),ch-viewport-width=(),ch-width=(),compute-pressure=(),conversion-measurement=(),cross-origin-isolated=(),deferred-fetch=(),deferred-fetch-minimal=(),display-capture=(),document-domain=(),encrypted-media=(),execution-while-not-rendered=(),execution-while-out-of-viewport=(),focus-without-user-activation=(),fullscreen=(),gamepad=(),geolocation=(),gyroscope=(),hid=(),identity-credentials-get=(),idle-detection=(),interest-cohort=(),join-ad-interest-group=(),keyboard-map=(),language-detector=(),local-fonts=(),magnetometer=(),microphone=(),midi=(),navigation-override=(),otp-credentials=(),payment=(),picture-in-picture=(),private-aggregation=(),private-state-token-issuance=(),private-state-token-redemption=(),publickey-credentials-create=(),publickey-credentials-get=(),rewriter=(),run-ad-auction=(),screen-wake-lock=(),serial=(),shared-storage=(),shared-storage-select-url=(),speaker-selection=(),storage-access=(),summarizer=(),sync-script=(),sync-xhr=(),translator=(),trust-token-redemption=(),unload=(),usb=(),vertical-scroll=(),web-share=(),window-management=(),window-placement=(),writer=(),xr-spatial-tracking=()
vary: Accept-Encoding
x-content-type-options: nosniff
x-csrf-token:
x-routed-by: portainer@docker
content-length: 13505

2025-10-13T18:33:42Z DBG github.com/traefik/traefik/v3/pkg/server/service/loadbalancer/wrr/wrr.go:175 > Service selected by WRR: http://172.22.0.3:9000
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/provider/docker/pdocker.go:111 > Provider event received {Status:start ID:e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e From:docker.n8n.io/n8nio/n8n:latest Type:container Action:start Actor:{ID:e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e Attributes:map[com.docker.compose.config-hash:cebb3df229222f10d0ca88a2474db42d365aa56870d56f580cd38abe20a86102 com.docker.compose.container-number:1 com.docker.compose.depends_on: com.docker.compose.image:sha256:7da8522a831870a2816e3e1cba50b2487b88bcaf31862d78010708f5b18afb71 com.docker.compose.oneoff:False com.docker.compose.project:n8n com.docker.compose.project.config_files:/opt/n8n/docker-compose.yml com.docker.compose.project.working_dir:/opt/n8n com.docker.compose.replace:n8n com.docker.compose.service:n8n com.docker.compose.version:2.40.0 image:docker.n8n.io/n8nio/n8n:latest name:n8n org.opencontainers.image.description:Workflow Automation Tool org.opencontainers.image.source:https://github.com/n8n-io/n8n org.opencontainers.image.title:n8n org.opencontainers.image.url:https://n8n.io org.opencontainers.image.version:1.114.4 traefik.enable:true traefik.http.middlewares.n8n-strip.stripprefix.prefixes:/n8n traefik.http.routers.n8n.entrypoints:websecure traefik.http.routers.n8n.middlewares:n8n-strip@docker traefik.http.routers.n8n.rule:Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/n8n`) traefik.http.services.n8n.loadbalancer.server.port:5678]} Scope:local Time:1760380434 TimeNano:1760380434240569702} providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/provider/docker/config.go:185 > Filtering disabled container container=traefik-traefik-5a9e32265b7c240f7c84bb2ca3cf2e0a6d8bcd73c1e9045dc611ff784c0e7578 providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/provider/docker/config.go:185 > Filtering disabled container container=node-exporter-44cab8caec02dbe258d888b61d65afd2edf39ae7c171632df45e5c5b8dc15122 providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/provider/docker/config.go:185 > Filtering disabled container container=watchtower-32de6747ac87bfc288422351b159d155db9f8100b9b000eadb7cee41bc9ea5b7 providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/provider/docker/config.go:185 > Filtering disabled container container=aerocaller-core-d933c708a8028efa79c18edea54225377f389c7f06243084adfbc1dd109b0f42 providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/provider/docker/config.go:185 > Filtering disabled container container=coturn-coturn-dd96b96c35252d36de48f783be0439dff39501c83baff5015029eedc92163950 providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"n8n-strip":{"stripPrefix":{"prefixes":["/n8n"]}},"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}},"portainer-strip":{"stripPrefix":{"prefixes":["/portainer"]}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"n8n":{"entryPoints":["websecure"],"middlewares":["n8n-strip@docker"],"rule":"Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/n8n`)","service":"n8n"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-strip@docker","portainer-headers@docker"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/portainer`)","service":"portainer","tls":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"n8n":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.4:5678"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:128 > No store is defined to add the certificate MIIDnDCCAyKgAwIBAgISBsGZuxVMwlqNyh0HQpA+8vC3MAoGCC, it will be added to the default store
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/tls/certificate_store.go:226 > Adding certificate for domain(s) nxcore.tail79107c.ts.net
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=SemConvServerMetrics
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=TracingEntryPoint
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/redirect/redirect_scheme.go:29 > Creating middleware entryPointName=web middlewareName=redirect-web-to-websecure@internal middlewareType=RedirectScheme routerName=web-to-websecure@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/redirect/redirect_scheme.go:30 > Setting up redirection to https 443 entryPointName=web middlewareName=redirect-web-to-websecure@internal middlewareType=RedirectScheme routerName=web-to-websecure@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/router.go:37 > Added outgoing tracing middleware entryPointName=web middlewareName=tracing middlewareType=TracingRouter routerName=web-to-websecure@internal serviceName=noop@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=SemConvServerMetrics routerName=web-to-websecure@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=TracingEntryPoint routerName=web-to-websecure@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/service/service.go:319 > Creating load-balancer entryPointName=web routerName=filebrowser@docker serviceName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/service/service.go:362 > Creating server URL=http://172.21.0.3:80 entryPointName=web routerName=filebrowser@docker serverIndex=0 serviceName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/service.go:26 > Added outgoing tracing middleware entryPointName=web middlewareName=tracing middlewareType=TracingService routerName=filebrowser@docker serviceName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/ipallowlist/ip_allowlist.go:32 > Creating middleware entryPointName=web middlewareName=tailnet-only@file middlewareType=IPAllowLister routerName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/ipallowlist/ip_allowlist.go:56 > Setting up IPAllowLister with sourceRange: [100.64.0.0/10] entryPointName=web middlewareName=tailnet-only@file middlewareType=IPAllowLister routerName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/middleware.go:33 > Adding tracing to middleware entryPointName=web middlewareName=tailnet-only@file routerName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/router.go:37 > Added outgoing tracing middleware entryPointName=web middlewareName=tracing middlewareType=TracingRouter routerName=filebrowser@docker serviceName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=SemConvServerMetrics routerName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=TracingEntryPoint routerName=filebrowser@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/recovery/recovery.go:25 > Creating middleware entryPointName=web middlewareName=traefik-internal-recovery middlewareType=Recovery
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=SemConvServerMetrics
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=TracingEntryPoint
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/router.go:37 > Added outgoing tracing middleware entryPointName=traefik middlewareName=tracing middlewareType=TracingRouter routerName=api@internal serviceName=api@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=SemConvServerMetrics routerName=api@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=TracingEntryPoint routerName=api@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/stripprefix/strip_prefix.go:31 > Creating middleware entryPointName=traefik middlewareName=dashboard_stripprefix@internal middlewareType=StripPrefix routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/middleware.go:33 > Adding tracing to middleware entryPointName=traefik middlewareName=dashboard_stripprefix@internal routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/redirect/redirect_regex.go:17 > Creating middleware entryPointName=traefik middlewareName=dashboard_redirect@internal middlewareType=RedirectRegex routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/redirect/redirect_regex.go:18 > Setting up redirection from ^(http:\/\/(\[[\w:.]+\]|[\w\._-]+)(:\d+)?)\/$ to ${1}/dashboard/ entryPointName=traefik middlewareName=dashboard_redirect@internal middlewareType=RedirectRegex routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/middleware.go:33 > Adding tracing to middleware entryPointName=traefik middlewareName=dashboard_redirect@internal routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/router.go:37 > Added outgoing tracing middleware entryPointName=traefik middlewareName=tracing middlewareType=TracingRouter routerName=dashboard@internal serviceName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=SemConvServerMetrics routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=TracingEntryPoint routerName=dashboard@internal
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/recovery/recovery.go:25 > Creating middleware entryPointName=traefik middlewareName=traefik-internal-recovery middlewareType=Recovery
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=SemConvServerMetrics
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingEntryPoint
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/service/service.go:319 > Creating load-balancer entryPointName=websecure routerName=n8n@docker serviceName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/service/service.go:362 > Creating server URL=http://172.22.0.4:5678 entryPointName=websecure routerName=n8n@docker serverIndex=0 serviceName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/service.go:26 > Added outgoing tracing middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingService routerName=n8n@docker serviceName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/stripprefix/strip_prefix.go:31 > Creating middleware entryPointName=websecure middlewareName=n8n-strip@docker middlewareType=StripPrefix routerName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/middleware.go:33 > Adding tracing to middleware entryPointName=websecure middlewareName=n8n-strip@docker routerName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/router.go:37 > Added outgoing tracing middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingRouter routerName=n8n@docker serviceName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=SemConvServerMetrics routerName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingEntryPoint routerName=n8n@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/recovery/recovery.go:25 > Creating middleware entryPointName=websecure middlewareName=traefik-internal-recovery middlewareType=Recovery
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=SemConvServerMetrics
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingEntryPoint
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/service/service.go:319 > Creating load-balancer entryPointName=websecure routerName=portainer@docker serviceName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/service/service.go:362 > Creating server URL=http://172.22.0.3:9000 entryPointName=websecure routerName=portainer@docker serverIndex=0 serviceName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/service.go:26 > Added outgoing tracing middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingService routerName=portainer@docker serviceName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/headers/headers.go:26 > Creating middleware entryPointName=websecure middlewareName=portainer-headers@docker middlewareType=Headers routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/headers/headers.go:46 > Setting up customHeaders/Cors from {map[] map[X-Routed-By:portainer@docker] false [] [] [] [] [] 0 false [] [] map[] 0 false false false false  false false       false <nil> <nil> <nil> <nil> <nil>} entryPointName=websecure middlewareName=portainer-headers@docker middlewareType=Headers routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/middleware.go:33 > Adding tracing to middleware entryPointName=websecure middlewareName=portainer-headers@docker routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/stripprefix/strip_prefix.go:31 > Creating middleware entryPointName=websecure middlewareName=portainer-strip@docker middlewareType=StripPrefix routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/middleware.go:33 > Adding tracing to middleware entryPointName=websecure middlewareName=portainer-strip@docker routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/router.go:37 > Added outgoing tracing middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingRouter routerName=portainer@docker serviceName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=SemConvServerMetrics routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=websecure middlewareName=tracing middlewareType=TracingEntryPoint routerName=portainer@docker
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/recovery/recovery.go:25 > Creating middleware entryPointName=websecure middlewareName=traefik-internal-recovery middlewareType=Recovery
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=SemConvServerMetrics
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=web middlewareName=tracing middlewareType=TracingEntryPoint
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/semconv.go:40 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=SemConvServerMetrics
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/middlewares/observability/entrypoint.go:37 > Creating middleware entryPointName=traefik middlewareName=tracing middlewareType=TracingEntryPoint
2025-10-13T18:33:54Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
2025-10-13T18:33:56Z DBG github.com/traefik/traefik/v3/pkg/server/service/loadbalancer/wrr/wrr.go:175 > Service selected by WRR: http://172.22.0.3:9000
glyph@nxcore:~$ sudo tee -a /etc/traefik/tls.yml >/dev/null <<'YAML'

http:
  routers:
    root-redirect:
      rule: Host(`nxcore.tail79107c.ts.net`) && Path(`/`)
      entryPoints: [websecure]
      service: noop@internal
      middlewares: [to-portainer]
  middlewares:
    to-portainer:
      redirectRegex:
        regex: ^https?://([^/]+)/?$
        replacement: https://$1/portainer
        permanent: true
YAML

docker restart traefik
traefik
glyph@nxcore:~$ # Replace Portainer compose with a dual-router setup
sudo tee /opt/portainer/compose-portainer.ee.yml >/dev/null <<'YAML'
services:
  portainer:
    image: portainer/portainer-ee:lts
    command: -H unix:///var/run/docker.sock
    restart: always
    networks: [traefik]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik

      # UI entry (user lands here)
      - traefik.http.routers.portainer-ui.rule=Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/portainer`)
      - traefik.http.routers.portainer-ui.entrypoints=websecure
      - traefik.http.routers.portainer-ui.tls=true
      - traefik.http.routers.portainer-ui.priority=2000
      - traefik.http.middlewares.portainer-strip.stripprefix.prefixes=/portainer
      - traefik.http.routers.portainer-ui.middlewares=portainer-strip@docker,tailnet-only@file
      - traefik.http.services.portainer.loadbalancer.server.port=9000

      # Assets + API (root paths used by the UI)
      - traefik.http.routers.portainer-assets.rule=Host(`nxcore.tail79107c.ts.net`) && (PathPrefix(`/api`) || PathPrefix(`/docker`) || PathPrefix(`/vendor`) || PathPrefix(`/main`) || PathPrefix(`/runtime`) || PathPrefix(`/assets`) || Path(`/favicon.ico`) || Path(`/robots.txt`) || Path(`/asset-manifest.json`))
      - traefik.http.routers.portainer-assets.entrypoints=websecure
      - traefik.http.routers.portainer-assets.tls=true
      - traefik.http.routers.portainer-assets.priority=1900
      - traefik.http.routers.portainer-assets.middlewares=tailnet-only@file
      # uses same service: portainer (no StripPrefix)

volumes:
  portainer_data:
networks:
  traefik:
    external: true
YAML

sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.3s
glyph@nxcore:~$ # API should work now
curl -I https://nxcore.tail79107c.ts.net/api/status

# UI entry still at /portainer, assets should load (no 404, no text/plain)
curl -I https://nxcore.tail79107c.ts.net/portainer
curl: (60) SSL certificate problem: self-signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
curl: (60) SSL certificate problem: self-signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
glyph@nxcore:~$ - traefik.http.routers.portainer-ui.rule=Host(`nxcore.tail79107c.ts.net`)
# (remove StripPrefix and the /portainer path)
-bash: syntax error near unexpected token `('
glyph@nxcore:~$ sudo nano /opt/traefik/compose-traefik.yml
glyph@nxcore:~$ openssl s_client -connect nxcore.tail79107c.ts.net:443 -servername nxcore.tail79107c.ts.net -showcerts </dev/null 2>/dev/null | openssl x509 -noout -subject -issuer
subject=CN = TRAEFIK DEFAULT CERT
issuer=CN = TRAEFIK DEFAULT CERT
glyph@nxcore:~$ # Traefik must have this flag:
docker inspect traefik --format '{{json .Config.Cmd}}' | jq -r '.[]' | egrep -i 'providers\.file|tls\.yml'

# Also confirm the file is present INSIDE the container and has the expected paths:
docker exec traefik sh -lc 'ls -l /etc/traefik/tls.yml /etc/traefik/tailscale/nxcore.crt /etc/traefik/tailscale/nxcore.key; echo; sed -n "1,120p" /etc/traefik/tls.yml'
--providers.file.filename=/etc/traefik/tls.yml
-rw-r--r--    1 root     root          2880 Oct 13 15:54 /etc/traefik/tailscale/nxcore.crt
-rw-------    1 root     root           227 Oct 13 15:54 /etc/traefik/tailscale/nxcore.key
-rw-r--r--    1 root     root           598 Oct 13 18:37 /etc/traefik/tls.yml

tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range

http:
  routers:
    root-redirect:
      rule: Host(`nxcore.tail79107c.ts.net`) && Path(`/`)
      entryPoints: [websecure]
      service: noop@internal
      middlewares: [to-portainer]
  middlewares:
    to-portainer:
      redirectRegex:
        regex: ^https?://([^/]+)/?$
        replacement: https://$1/portainer
        permanent: true
glyph@nxcore:~$ docker inspect traefik --format '{{json .Config.Cmd}}' | jq -r '.[]' | egrep -i 'providers\.file|tls\.yml'
--providers.file.filename=/etc/traefik/tls.yml
glyph@nxcore:~$ docker exec traefik sh -lc 'ls -l /etc/traefik/tls.yml /etc/traefik/tailscale/nxcore.crt /etc/traefik/tailscale/nxcore.key; echo; sed -n "1,120p" /etc/traefik/tls.yml'
-rw-r--r--    1 root     root          2880 Oct 13 15:54 /etc/traefik/tailscale/nxcore.crt
-rw-------    1 root     root           227 Oct 13 15:54 /etc/traefik/tailscale/nxcore.key
-rw-r--r--    1 root     root           598 Oct 13 18:37 /etc/traefik/tls.yml

tls:
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10   # Tailscale CGNAT range

http:
  routers:
    root-redirect:
      rule: Host(`nxcore.tail79107c.ts.net`) && Path(`/`)
      entryPoints: [websecure]
      service: noop@internal
      middlewares: [to-portainer]
  middlewares:
    to-portainer:
      redirectRegex:
        regex: ^https?://([^/]+)/?$
        replacement: https://$1/portainer
        permanent: true
glyph@nxcore:~$ ls /etc/ssl/certs/*Let*s*Encrypt*R3*.pem 2>/dev/null || ls /etc/ssl/certs/*ISRG*X1*.pem 2>/dev/null
/etc/ssl/certs/ISRG_Root_X1.pem
glyph@nxcore:~$ sudo sh -lc 'cat /etc/traefik/tailscale/nxcore.crt /etc/ssl/certs/lets-encrypt-r3.pem > /etc/traefik/tailscale/nxcore.fullchain.crt'
[sudo] password for glyph:
cat: /etc/ssl/certs/lets-encrypt-r3.pem: No such file or directory
glyph@nxcore:~$ sudo tee /opt/portainer/compose-portainer.ee.yml >/dev/null <<'YAML'
services:
  portainer:
    image: portainer/portainer-ee:lts
    command: -H unix:///var/run/docker.sock
    restart: always
    networks: [traefik]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik

      # root of this host
      - traefik.http.routers.portainer.rule=Host(`nxcore.tail79107c.ts.net`)
      - traefik.http.routers.portainer.entrypoints=websecure
      - traefik.http.routers.portainer.tls=true
      - traefik.http.routers.portainer.priority=2000

      # Portainer listens on 9000
      - traefik.http.services.portainer.loadbalancer.server.port=9000

      # keep the marker header (handy)
      - traefik.http.middlewares.portainer-headers.headers.customResponseHeaders.X-Routed-By=portainer@docker
      - traefik.http.routers.portainer.middlewares=portainer-headers@docker,tailnet-only@file
volumes:
  portainer_data:
networks:
  traefik:
    external: true
YAML

sudo docker compose -f /opt/portainer/compose-portainer.ee.yml up -d
[+] Running 1/1
 ✔ Container portainer-portainer-1  Started                                                                        0.4s
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net
# expect 200/302 and ideally: X-Routed-By: portainer@docker
curl: (60) SSL certificate problem: self-signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
glyph@nxcore:~$ # Check CN/SANs and whether the file already includes intermediates
sudo openssl x509 -in /etc/traefik/tailscale/nxcore.crt -noout -subject -issuer -text | sed -n '1,80p'
subject=CN = nxcore.tail79107c.ts.net
issuer=C = US, O = Let's Encrypt, CN = E7
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            06:c1:99:bb:15:4c:c2:5a:8d:ca:1d:07:42:90:3e:f2:f0:b7
        Signature Algorithm: ecdsa-with-SHA384
        Issuer: C = US, O = Let's Encrypt, CN = E7
        Validity
            Not Before: Oct 12 02:56:58 2025 GMT
            Not After : Jan 10 02:56:57 2026 GMT
        Subject: CN = nxcore.tail79107c.ts.net
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:43:89:bc:ac:dd:de:a7:76:62:d2:e0:ee:1e:e4:
                    5d:64:d5:8e:f4:1b:4e:51:ba:36:4e:a2:79:70:48:
                    b6:b9:7f:45:14:a1:4d:90:a2:9d:9c:4e:80:3b:49:
                    ce:9a:61:74:6b:e2:38:ae:9d:9d:35:be:ac:34:5f:
                    a7:7d:82:23:eb
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Key Identifier:
                B1:9F:5E:42:92:EE:35:2A:7F:28:90:C7:17:79:81:E2:49:70:18:29
            X509v3 Authority Key Identifier:
                AE:48:9E:DC:87:1D:44:A0:6F:DA:A2:E5:60:74:04:78:C2:9C:00:80
            Authority Information Access:
                CA Issuers - URI:http://e7.i.lencr.org/
            X509v3 Subject Alternative Name:
                DNS:nxcore.tail79107c.ts.net
            X509v3 Certificate Policies:
                Policy: 2.23.140.1.2.1
            X509v3 CRL Distribution Points:
                Full Name:
                  URI:http://e7.c.lencr.org/56.crl
            CT Precertificate SCTs:
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : 19:86:D4:C7:28:AA:6F:FE:BA:03:6F:78:2A:4D:01:91:
                                AA:CE:2D:72:31:0F:AE:CE:5D:70:41:2D:25:4C:C7:D4
                    Timestamp : Oct 12 03:55:28.181 2025 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:45:02:21:00:88:F6:7A:C4:2F:BF:E5:F0:14:37:79:
                                EB:F3:ED:73:5C:CD:DC:E3:12:16:35:2B:3C:08:90:BD:
                                97:98:03:A6:35:02:20:4B:1A:0B:D5:15:9F:B6:D7:B0:
                                3B:22:EB:90:2B:A7:C3:7E:8F:D6:66:F4:A5:28:D1:07:
                                47:41:C8:2A:9F:95:5C
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : 0E:57:94:BC:F3:AE:A9:3E:33:1B:2C:99:07:B3:F7:90:
                                DF:9B:C2:3D:71:32:25:DD:21:A9:25:AC:61:C5:4E:21
                    Timestamp : Oct 12 03:55:28.181 2025 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:44:02:20:25:73:30:A0:20:2C:6B:D2:18:BA:09:AB:
                                18:5C:6B:77:38:D0:80:8F:D2:BB:A3:18:6B:40:BE:16:
                                91:71:0C:52:02:20:2A:6E:3D:BE:8F:29:71:59:FE:C7:
                                F6:ED:16:CB:5D:53:02:5B:FA:22:40:90:40:E7:57:B1:
                                23:A7:E8:A7:58:8D
    Signature Algorithm: ecdsa-with-SHA384
    Signature Value:
        30:65:02:30:23:1d:99:d3:61:3c:ea:ce:f5:24:25:94:57:03:
        3c:2d:2d:b3:94:47:7d:49:06:23:eb:d9:b5:00:0d:c6:82:8e:
        fa:9f:4e:78:c5:88:37:2f:f6:8f:3e:60:6a:d9:5b:a0:02:31:
        00:c5:a1:80:68:4b:44:fd:bd:95:cb:7a:be:d9:2a:d3:60:d1:
        32:c7:e4:a8:1c:81:9e:72:7b:55:2a:63:4a:34:89:c2:03:89:
        c8:de:f2:f5:6e:06:d7:e5:4c:ed:42:ab:9a
glyph@nxcore:~$ # Back up the current file
sudo cp /etc/traefik/tls.yml /etc/traefik/tls.yml.bak

# Write a clean dynamic config: one tls: and one http:
sudo tee /etc/traefik/tls.yml >/dev/null <<'YAML'
tls:
  stores:
    default:
      defaultCertificate:
        certFile: /etc/traefik/tailscale/nxcore.crt
        keyFile:  /etc/traefik/tailscale/nxcore.key
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange: [100.64.0.0/10]
  routers:
    root-redirect:
      rule: Host(`nxcore.tail79107c.ts.net`) && Path(`/`)
      entryPoints: [websecure]
      service: noop@internal
      middlewares: [to-portainer]
  middlewares:
    to-portainer:
      redirectRegex:
        regex: ^https?://([^/]+)/?$
        replacement: https://$1/portainer
        permanent: true
YAML

# Reload Traefik
docker restart traefik

# You should see "Adding certificate for domain(s) ..." in logs:
docker logs --since 30s traefik | egrep -i 'certificate|tls|error' || true

# Now confirm the served cert is no longer the default
openssl s_client -connect nxcore.tail79107c.ts.net:443 -servername nxcore.tail79107c.ts.net -showcerts </dev/null 2>/dev/null | openssl x509 -noout -subject -issuer
traefik
2025-10-13T19:14:06Z ERR github.com/traefik/traefik/v3/pkg/provider/file/file.go:144 > Error occurred during watcher callback error="yaml: unmarshal errors:\n  line 22: mapping key \"middlewares\" already defined at line 12" providerName=file
Could not read certificate from <stdin>
403729BF117E0000:error:1608010C:STORE routines:ossl_store_handle_load_result:unsupported:../crypto/store/store_result.c:151:
Unable to load certificate
glyph@nxcore:~$ docker logs --since 30s traefik | egrep -i 'certificate|tls|error' || true
2025-10-13T19:14:07Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:07Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:07Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:14:07Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:14:07Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
2025-10-13T19:14:35Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"n8n-strip":{"stripPrefix":{"prefixes":["/n8n"]}},"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"n8n":{"entryPoints":["websecure"],"middlewares":["n8n-strip@docker"],"rule":"Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/n8n`)","service":"n8n"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-headers@docker","tailnet-only@file"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`)","service":"portainer","tls":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"n8n":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.4:5678"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T19:14:35Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:35Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:14:35Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:14:35Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
glyph@nxcore:~$ sudo tee /etc/traefik/tls.yml >/dev/null <<'YAML'
tls:
  stores:
    default:
      defaultCertificate:
        certFile: /etc/traefik/tailscale/nxcore.crt
        keyFile:  /etc/traefik/tailscale/nxcore.key
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange: [100.64.0.0/10]
  routers:
    root-redirect:
      rule: Host(`nxcore.tail79107c.ts.net`) && Path(`/`)
      entryPoints: [websecure]
      service: noop@internal
      middlewares: [to-portainer]
  middlewares:
    to-portainer:
      redirectRegex:
        regex: ^https?://([^/]+)/?$
        replacement: https://$1/portainer
        permanent: true
YAML

# Reload Traefik
docker restart traefik
traefik
glyph@nxcore:~$ docker logs --since 30s traefik | egrep -i 'certificate|tls|error' || true
2025-10-13T19:14:35Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"n8n-strip":{"stripPrefix":{"prefixes":["/n8n"]}},"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"n8n":{"entryPoints":["websecure"],"middlewares":["n8n-strip@docker"],"rule":"Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/n8n`)","service":"n8n"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-headers@docker","tailnet-only@file"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`)","service":"portainer","tls":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"n8n":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.4:5678"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T19:14:35Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:35Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:14:35Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:14:35Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
2025-10-13T19:14:37Z ERR github.com/traefik/traefik/v3/pkg/provider/docker/config.go:82 > error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T19:14:37Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-headers@docker","tailnet-only@file"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`)","service":"portainer","tl":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T19:14:37Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:37Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:14:37Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:14:37Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
2025-10-13T19:14:57Z ERR github.com/traefik/traefik/v3/pkg/provider/file/file.go:144 > Error occurred during watcher callback error="yaml: unmarshal errors:\n  line 22: mapping key \"middlewares\" already defined at line 12" providerName=file
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/cmd/traefik/traefik.go:114 > Static configuration loaded [json] staticConfiguration={"api":{"basePath":"/","dashboard":true,"insecure":true},"entryPoints":{"traefik":{"address":":8080","forwardedHeaders":{},"http":{"maxHeaderBytes":1048576,"sanitizePath":true},"http2":{"maxConcurrentStreams":250},"transport":{"lifeCycle":{"graceTimeOut":"10s"},"respondingTimeouts":{"idleTimeout":"3m0s","readTimeout":"1m0s"}},"udp":{"timeout":"3s"}},"web":{"address":":80","forwardedHeaders":{},"http":{"maxHeaderBytes":1048576,"redirections":{"entryPoint":{"permanent":true,"priority":9223372036854775806,"scheme":"https","to":"websecure"}},"sanitizePath":true},"http2":{"maxConcurrentStreams":250},"transport":{"lifeCycle":{"graceTimeOut":"10s"},"respondingTimeouts":{"idleTimeout":"3m0s","readTimeout":"1m0s"}},"udp":{"timeout":"3s"}},"websecure":{"address":":443","forwardedHeaders":{},"http":{"maxHeaderBytes":1048576,"sanitizePath":true},"http2":{"maxConcurrentStreams":250},"transport":{"lifeCycle":{"graceTimeOut":"10s"},"respondingTimeouts":{"idleTimeout":"3m0s","readTimeout":"1m0s"}},"udp":{"timeout":"3s"}}},"global":{"checkNewVersion":true},"log":{"format":"common","level":"DEBUG"},"providers":{"docker":{"defaultRule":"Host(`{{ normalize .Name }}`)","endpoint":"unix:///var/run/docker.sock","watch":true},"file":{"filename":"/etc/traefik/tls.yml","watch":true},"providersThrottleDuration":"2s"},"serversTransport":{"maxIdleConnsPerHost":200},"tcpServersTransport":{"dialKeepAlive":"15s","dialTimeout":"30s"}}
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/provider/aggregator/aggregator.go:207 > *file.Provider provider configuration config={"filename":"/etc/traefik/tls.yml","watch":true}
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/provider/file/file.go:122 > add watcher on: /etc/traefik/tls.yml
2025-10-13T19:14:58Z ERR github.com/traefik/traefik/v3/pkg/provider/file/file.go:105 > Error while building configuration (for the first time) error="yaml: unmarshal errors:\n  line 22: mapping key \"middlewares\" already defined at line 12" providerName=file
2025-10-13T19:14:58Z INF github.com/traefik/traefik/v3/pkg/provider/aggregator/aggregator.go:206 > Starting provider *acme.ChallengeTLSALPN
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/provider/aggregator/aggregator.go:207 > *acme.ChallengeTLSALPN provider configuration config={}
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"dashboard_redirect":{"redirectRegex":{"permanent":true,"regex":"^(http:\\/\\/(\\[[\\w:.]+\\]|[\\w\\._-]+)(:\\d+)?)\\/$","replacement":"${1}/dashboard/"}},"dashboard_stripprefix":{"stripPrefix":{"prefixes":["/dashboard/","/dashboard"]}},"redirect-web-to-websecure":{"redirectScheme":{"permanent":true,"port":"443","scheme":"https"}}},"routers":{"api":{"entryPoints":["traefik"],"priority":9223372036854775806,"rule":"PathPrefix(`/api`)","ruleSyntax":"default","service":"api@internal"},"dashboard":{"entryPoints":["traefik"],"middlewares":["dashboard_redirect@internal","dashboard_stripprefix@internal"],"priority":9223372036854775805,"rule":"PathPrefix(`/`)","ruleSyntax":"default","service":"dashboard@internal"},"web-to-websecure":{"entryPoints":["web"],"middlewares":["redirect-web-to-websecure"],"priority":9223372036854775806,"rule":"HostRegexp(`^.+$`)","ruleSyntax":"default","service":"noop@internal"}},"serversTransports":{"default":{"maxIdleConnsPerHost":200}},"services":{"api":{},"dashboard":{},"noop":{}}},"tcp":{"serversTransports":{"default":{"dialKeepAlive":"15s","dialTimeout":"30s"}}},"tls":{},"udp":{}} providerName=internal
2025-10-13T19:14:58Z ERR github.com/traefik/traefik/v3/pkg/provider/docker/config.go:82 > error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-headers@docker","tailnet-only@file"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`)","service":"portainer","tl":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:14:58Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:14:58Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:14:58Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
glyph@nxcore:~$ openssl s_client -connect nxcore.tail79107c.ts.net:443 -servername nxcore.tail79107c.ts.net -showcerts </dev/null 2>/dev/null | openssl x509 -noout -subject -issuer
subject=CN = TRAEFIK DEFAULT CERT
issuer=CN = TRAEFIK DEFAULT CERT
glyph@nxcore:~$ # backup
sudo cp /etc/traefik/tls.yml /etc/traefik/tls.yml.bak

# write a clean config (one tls:, one http:)
sudo tee /etc/traefik/tls.yml >/dev/null <<'YAML'
tls:
  stores:
    default:
      defaultCertificate:
        certFile: /etc/traefik/tailscale/nxcore.crt
        keyFile:  /etc/traefik/tailscale/nxcore.key
  certificates:
    - certFile: /etc/traefik/tailscale/nxcore.crt
      keyFile:  /etc/traefik/tailscale/nxcore.key

http:
  middlewares:
    tailnet-only:
      ipAllowList:
        sourceRange:
          - 100.64.0.0/10
    to-portainer:
      redirectRegex:
        regex: ^https?://([^/]+)/?$
        replacement: https://$1/portainer
        permanent: true

  routers:
    root-redirect:
      rule: Host(`nxcore.tail79107c.ts.net`) && Path(`/`)
      entryPoints:
        - websecure
      service: noop@internal
      middlewares:
        - to-portainer
YAML

# reload traefik
docker restart traefik

# confirm file provider loads without YAML errors and that cert is added
docker logs --since 30s traefik | egrep -i 'file provider|loaded|certificate|tls|error' || true

# verify the served certificate (should NOT be TRAEFIK DEFAULT CERT)
openssl s_client -connect nxcore.tail79107c.ts.net:443 -servername nxcore.tail79107c.ts.net -showcerts </dev/null 2>/dev/null | openssl x509 -noout -subject -issuer
traefik
2025-10-13T19:18:45Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"n8n-strip":{"stripPrefix":{"prefixes":["/n8n"]}},"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"n8n":{"entryPoints":["websecure"],"middlewares":["n8n-strip@docker"],"rule":"Host(`nxcore.tail79107c.ts.net`) && PathPrefix(`/n8n`)","service":"n8n"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-headers@docker","tailnet-only@file"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`)","service":"portainer","tls":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"n8n":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.4:5678"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T19:18:45Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:18:45Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:18:45Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:18:45Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
2025-10-13T19:18:47Z ERR github.com/traefik/traefik/v3/pkg/provider/docker/config.go:82 > error="service \"n8n\" error: unable to find the IP address for the container \"/n8n\": the server is ignored" container=n8n-n8n-e029fa8a11d60ea8048ec75f05a67e66fa4d367d05540db7fae8e795781fac5e providerName=docker
2025-10-13T19:18:47Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"portainer-headers":{"headers":{"customResponseHeaders":{"X-Routed-By":"portainer@docker"}}}},"routers":{"filebrowser":{"entryPoints":["web"],"middlewares":["tailnet-only@file"],"rule":"Host(`files.av`) || Host(`files.aerovista.local`)","service":"filebrowser"},"portainer":{"entryPoints":["websecure"],"middlewares":["portainer-headers@docker","tailnet-only@file"],"priority":2000,"rule":"Host(`nxcore.tail79107c.ts.net`)","service":"portainer","tl":{}}},"services":{"filebrowser":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.21.0.3:80"}],"strategy":"wrr"}},"portainer":{"loadBalancer":{"passHostHeader":true,"responseForwarding":{"flushInterval":"100ms"},"servers":[{"url":"http://172.22.0.3:9000"}],"strategy":"wrr"}}}},"tcp":{},"tls":{},"udp":{}} providerName=docker
2025-10-13T19:18:48Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:386 > No default certificate, fallback to the internal generated certificate tlsStoreName=default
2025-10-13T19:18:48Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=web routerName=filebrowser@docker
2025-10-13T19:18:48Z ERR github.com/traefik/traefik/v3/pkg/server/router/router.go:155 > error="middleware \"tailnet-only@file\" does not exist" entryPointName=websecure routerName=portainer@docker
2025-10-13T19:18:48Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
2025-10-13T19:19:12Z DBG github.com/traefik/traefik/v3/pkg/server/configurationwatcher.go:227 > Configuration received config={"http":{"middlewares":{"tailnet-only":{"ipAllowList":{"sourceRange":["100.64.0.0/10"]}},"to-portainer":{"redirectRegex":{"permanent":true,"regex":"^https?://([^/]+)/?$","replacement":"https://$1/portainer"}}},"routers":{"root-redirect":{"entryPoints":["websecure"],"middlewares":["to-portainer"],"rule":"Host(`nxcore.tail79107c.ts.net`) && Path(`/`)","service":"noop@internal"}}},"tcp":{},"tls":{"stores":{"default":{}}},"udp":{}} providerName=file
2025-10-13T19:19:12Z DBG github.com/traefik/traefik/v3/pkg/tls/tlsmanager.go:128 > No store is defined to add the certificate MIIDnDCCAyKgAwIBAgISBsGZuxVMwlqNyh0HQpA+8vC3MAoGCC, it will be added to the default store
2025-10-13T19:19:12Z DBG github.com/traefik/traefik/v3/pkg/tls/certificate_store.go:226 > Adding certificate for domain(s) nxcore.tail79107c.ts.net
2025-10-13T19:19:12Z DBG github.com/traefik/traefik/v3/pkg/server/router/tcp/manager.go:237 > Adding route for nxcore.tail79107c.ts.net with TLS options default entryPointName=websecure
subject=CN = nxcore.tail79107c.ts.net
issuer=C = US, O = Let's Encrypt, CN = E7
glyph@nxcore:~$ curl -I https://nxcore.tail79107c.ts.net/portainer
curl -I https://nxcore.tail79107c.ts.net
HTTP/2 404
content-security-policy: script-src 'self' cdn.matomo.cloud js.hsforms.net https://www.google.com/recaptcha/, https://www.gstatic.com/recaptcha/; object-src 'none'; frame-ancestors 'none'; frame-src https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/
content-type: text/plain; charset=utf-8
date: Mon, 13 Oct 2025 19:19:52 GMT
vary: Accept-Encoding
x-content-type-options: nosniff
x-routed-by: portainer@docker
content-length: 19

HTTP/2 307
content-type: text/html; charset=utf-8
date: Mon, 13 Oct 2025 19:19:52 GMT
location: /timeout.html
x-routed-by: portainer@docker

glyph@nxcore:~$
